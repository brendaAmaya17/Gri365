<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRI365 - Inventario TI</title>
    <link rel="stylesheet" href="./../styles.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>
<body class="project-page"> 
    
    <div class="page-container">
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="https://ik.imagekit.io/v3kitfabd/gri365/solo%20ojo%20oscuro.png?updatedAt=1759508923355" alt="Logo Claro" class="logo-light">
                <img src="https://ik.imagekit.io/v3kitfabd/gri365/solo%20ojo%20claro.png?updatedAt=1759508923395" alt="Logo Oscuro" class="logo-dark hidden">
            </div>
            <nav class="navigation">
                <a class="nav-link" href="./../index.html"><span class="material-symbols-outlined">dashboard</span><span>Inicio</span></a>
                <a class="nav-link" href="#"><span class="material-symbols-outlined">list_alt</span><span>FixIT</span></a>
                <a class="nav-link" href="./../pages/gestion.html"><span class="material-symbols-outlined">add_task</span><span>Gestión de Proyectos</span></a>
                <a class="nav-link" href="./../pages/marketing.html"><span class="material-symbols-outlined">linked_camera</span><span>CAM</span></a>
                <a class="nav-link active" href="./../pages/directorio.html"><span class="material-symbols-outlined">inventory</span><span>Directorio</span></a>
            </nav>
            <div class="sidebar-footer">
                <a class="nav-link" href="#"><span class="material-symbols-outlined">logout</span><span>Cerrar Sesión</span></a>
            </div>
        </aside>

        <main class="main-content">
            
            <header class="project-header">
                <div class="project-header-main">
                    <div class="project-logo">
                        <span class="material-symbols-outlined">inventory</span>
                        <h2 class="titulo">Directorio de Usuarios</h2>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="theme-toggle-btn" class="icon-button" title="Alternar tema">
                        <span class="material-symbols-outlined sun-icon">light_mode</span>
                        <span class="material-symbols-outlined moon-icon hidden">dark_mode</span>
                    </button>
                    <a href="#" class="icon-button" title="Cerrar Sesión">
                        <span class="material-symbols-outlined">logout</span>
                    </a>
                </div>
            </header>

            <div class="content-area">
                <div id="inventory-module-scope" class="max-width-7xl">
                    
                    <div id="view-directory" class="view-section active">
                        <!-- Pestañas de Activo/Inactivo/Inventario -->
                        <div class="tabs-container" style="margin-bottom: 1.5rem;">
                            <button class="tab-btn active" onclick="switchEmployeeTab('active', this)">Empleados Activos</button>
                            <button class="tab-btn" onclick="switchEmployeeTab('inactive', this)">Empleados Inactivos</button>
                            <button class="tab-btn" onclick="switchEmployeeTab('inventory', this)">Inventario</button>
                        </div>

                        <!-- Botón Agregar Empleado - Solo visible en pestaña "Empleados Activos" -->
                            <div id="add-employee-btn-container" style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                <button class="btn-primary-highlight" onclick="showAddEmployeeForm()">
                                    <span class="material-symbols-outlined icon-base">add</span>
                                    Agregar Empleado
                                </button>
                            </div>

                            <!-- Modal/Formulario de Registro de Empleado - Inicialmente oculto -->
                           <div id="add-employee-modal" class="modal-overlay" style="display: none; z-index: 1000;">
                                <div class="modal-content">
                                    <!-- Encabezado del Modal -->
                                    <div class="modal-header">
                                        <h2 class="modal-title">Completa la información del nuevo empleado</h2>
                                        <p class="modal-subtitle">Sigue los pasos para registrar todos los datos.</p>
                                        <button class="modal-close-btn" onclick="closeAddEmployeeForm()">
                                            <span class="material-symbols-outlined">close</span>
                                        </button>
                                    </div>

                                    <!-- Indicador de Pasos -->
                                    <div class="steps-container">
                                        <div class="step-item active" data-step="1">
                                            <div class="step-circle">1</div>
                                            <div class="step-label">Información Personal</div>
                                        </div>
                                        <div class="step-connector"></div>
                                        <div class="step-item" data-step="3">
                                            <div class="step-circle">2</div>
                                            <div class="step-label">Informacion Laboral</div>
                                        </div>
                                        <div class="step-connector"></div>
                                        <div class="step-item" data-step="4">
                                            <div class="step-circle">3</div>
                                            <div class="step-label">Hardware</div>
                                        </div>
                                        <div class="step-connector"></div>
                                        <div class="step-item" data-step="5">
                                            <div class="step-circle">4</div>
                                            <div class="step-label">Software</div>
                                        </div>
                                    </div>

                                    <!-- Contenido del Formulario por Pasos -->
                                    <div class="form-steps-content">
                                        
                                        <!-- PASO 1: Información Personal -->
                                        <div class="form-step active" data-step="1">
                                            <div class="edit-form-grid">
                                                <div class="form-input-group">
                                                    <label class="form-label">Nombre Completo</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Ana María García Pérez" />
                                                        <span class="material-symbols-outlined input-icon">person</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Fecha de Nacimiento</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="date" />
                                                        <span class="material-symbols-outlined input-icon">calendar_today</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Cédula</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: V-12.345.678" />
                                                        <span class="material-symbols-outlined input-icon">badge</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Celular</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="tel" placeholder="Ej: +58 412-1234567" />
                                                        <span class="material-symbols-outlined input-icon">phone</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Correo</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="email" placeholder="Ej: ana.garcia@email.com" />
                                                        <span class="material-symbols-outlined input-icon">email</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Dirección de Residencia</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Calle Falsa 123, Apto 4B" />
                                                        <span class="material-symbols-outlined input-icon">home</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Ciudad / Departamento</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Bogotá D.C." />
                                                        <span class="material-symbols-outlined input-icon">location_city</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Teléfono de Emergencia</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="tel" placeholder="Ej: +57 310-9876543" />
                                                        <span class="material-symbols-outlined input-icon">emergency</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Persona de Contacto en Emergencias</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Carlos Pérez" />
                                                        <span class="material-symbols-outlined input-icon">contact_emergency</span>
                                                    </div>
                                                </div>
                                                <div class="form-input-group">
                                                    <label class="form-label">Parentesco del Contacto de Emergencia</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Padre" />
                                                        <span class="material-symbols-outlined input-icon">family_restroom</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- PASO 2: Info. laboral -->
                                        <div class="form-step" data-step="2">
                                            <div class="edit-form-grid">
                                                <!-- Cargo -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Cargo</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Desarrollador Senior" />
                                                        <span class="material-symbols-outlined input-icon">work</span>
                                                    </div>
                                                </div>

                                                <!-- Área / Departamento -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Área / Departamento</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Tecnología de la Información" />
                                                        <span class="material-symbols-outlined input-icon">domain</span>
                                                    </div>
                                                </div>

                                                <!-- Jefe Inmediato -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Jefe Inmediato</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" placeholder="Ej: Carlos Rodríguez" />
                                                        <span class="material-symbols-outlined input-icon">supervisor_account</span>
                                                    </div>
                                                </div>

                                                <!-- Correo Corporativo -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Correo Corporativo</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="email" placeholder="Ej: ana.garcia@gri365.com" />
                                                        <span class="material-symbols-outlined input-icon">email</span>
                                                    </div>
                                                </div>

                                                <!-- Inicio de Contrato -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Inicio de Contrato</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="date" />
                                                        <span class="material-symbols-outlined input-icon">calendar_today</span>
                                                    </div>
                                                </div>
                                                <!-- Id biometrico -->
                                                <div class="form-input-group">
                                                    <label class="form-label">Id biometrico</label>
                                                    <div class="input-with-icon">
                                                        <input class="form-input" type="text" />
                                                        <span class="material-symbols-outlined input-icon">fingerprint</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- PASO 3: Hardware -->
                                        <div class="form-step" data-step="3">
                                            
                                            <!-- Barra de búsqueda y botón Agregar Hardware -->
                                            <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1.5rem;">
                                                <div class="search-container shadow-sm" style="flex: 1; margin: 0;">
                                                    <span class="material-symbols-outlined search-icon">search</span>
                                                    <input 
                                                        class="search-input" 
                                                        id="hardware-search-input" 
                                                        placeholder="Buscar por nombre, modelo o serial..." 
                                                        type="text"
                                                    />
                                                </div>
                                                <button class="btn-primary-highlight" onclick="openAddHardwareModal()" type="button">
                                                    <span class="material-symbols-outlined icon-base">add</span>
                                                    Agregar Hardware
                                                </button>
                                            </div>

                                            <!-- Tabla de Hardware Asignado -->
                                            <div style="margin-bottom: 1rem;">
                                                <h4 style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.75rem; color: var(--text-primary);">
                                                    Hardware Asignado
                                                </h4>
                                            </div>

                                            <div class="table-container">
                                                <table class="data-table" id="assigned-hardware-table">
                                                    <thead>
                                                        <tr>
                                                            <th>DISPOSITIVO</th>
                                                            <th>MODELO</th>
                                                            <th>SERIAL</th>
                                                            <th>ACCIONES</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Los dispositivos se agregarán dinámicamente aquí -->
                                                        <tr id="no-hardware-row">
                                                            <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                                                No hay hardware asignado aún. Usa el botón "Agregar Hardware" para comenzar.
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>

                                        <!-- PASO 4: Software -->
                                        <div class="form-step" data-step="4">
                                            
                                            <!-- Software Existente -->
                                            <div class="form-input-group" style="margin-bottom: 1.5rem;">
                                                <label class="form-label">Software Existente</label>
                                                <select 
                                                    class="form-input" 
                                                    id="existing-software-select" 
                                                    multiple 
                                                    style="min-height: 120px;">
                                                    <option value="office365">Microsoft Office 365 - Licencia E3</option>
                                                    <option value="adobe">Adobe Creative Cloud - Todas las aplicaciones</option>
                                                    <option value="slack">Slack - Plan Pro</option>
                                                    <option value="figma">Figma - Licencia Profesional</option>
                                                    <option value="jira">Jira - Acceso Completo</option>
                                                    <option value="gitlab">GitLab - Rol de Mantenedor</option>
                                                    <option value="zoom">Zoom - Plan Business</option>
                                                    <option value="canva">Canva Pro</option>
                                                </select>
                                                <small style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.5rem; display: block;">
                                                    Mantén presionada la tecla Ctrl (Cmd en Mac) para seleccionar múltiples opciones
                                                </small>
                                            </div>

                                            <!-- Separador visual con "O" -->
                                            <div style="display: flex; align-items: center; margin: 2rem 0; gap: 1rem;">
                                                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                                                <span style="color: var(--text-secondary); font-weight: 500; font-size: 0.9rem;">O</span>
                                                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                                            </div>

                                            <!-- Desplegable: Crear Nuevo Software -->
                                            <details class="collapsible-section">
                                                <summary class="collapsible-header">
                                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                        <span class="material-symbols-outlined" style="font-size: 1.25rem;">add_circle</span>
                                                        <span style="font-weight: 500;">Crear Nuevo Software</span>
                                                    </div>
                                                    <span class="material-symbols-outlined chevron-icon">expand_more</span>
                                                </summary>
                                                <div class="collapsible-content" style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 0.5rem; margin-top: 0.75rem;">
                                                    <p style="margin: 0 0 1rem 0; color: var(--text-secondary); font-size: 0.9rem;">
                                                        ¿No encuentras el software que necesitas? Créalo desde aquí para agregarlo al inventario.
                                                    </p>
                                                    <button 
                                                        class="btn-primary-highlight" 
                                                        type="button" 
                                                        id="btn-open-software-modal"
                                                        style="width: 100%;"
                                                    >
                                                        <span class="material-symbols-outlined icon-base">add</span>
                                                        Abrir Formulario de Software
                                                    </button>
                                                </div>
                                            </details>
                                        </div>
                                    </div>

                                    <!-- Botones de Navegación -->
                                    <div class="form-navigation">
                                        <button class="btn-outline" id="prev-step-btn" onclick="previousStep()" style="display: none;">
                                            <span class="material-symbols-outlined icon-base">arrow_back</span>
                                            Anterior
                                        </button>
                                        <button class="btn-primary-highlight" id="next-step-btn" onclick="nextStep()">
                                            Siguiente
                                            <span class="material-symbols-outlined icon-base">arrow_forward</span>
                                        </button>
                                        <button class="btn-primary-highlight" id="submit-form-btn" onclick="submitEmployeeForm()" style="display: none;">
                                            <span class="material-symbols-outlined icon-base">check</span>
                                            Guardar Empleado
                                        </button>
                                    </div>
                                </div>
                            </div>

                        <div class="search-container shadow-sm">
                            <span class="material-symbols-outlined search-icon">search</span>
                            <input class="search-input" id="search-input" placeholder="Buscar por nombre o puesto..." type="text"/>
                        </div>
                        
                        <!-- Grid de empleados activos -->
                        <div id="active-employees-grid" class="inventory-grid">
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=9");'></div>
                                <div class="card-text">
                                    <p class="name">Ana Garcia</p>
                                    <p class="role">Directora de TI</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Ana Garcia', 'Directora de TI', '9', 'active')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=51");'></div>
                                <div class="card-text">
                                    <p class="name">Ben Carter</p>
                                    <p class="role">Administrador de Red</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Ben Carter', 'Administrador de Red', '51', 'active')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=5");'></div>
                                <div class="card-text">
                                    <p class="name">Chloe Davis</p>
                                    <p class="role">Analista de Sistemas</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Chloe Davis', 'Analista de Sistemas', '5', 'active')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=11");'></div>
                                <div class="card-text">
                                    <p class="name">David Evans</p>
                                    <p class="role">Soporte Técnico</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('David Evans', 'Soporte Técnico', '11', 'active')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=49");'></div>
                                <div class="card-text">
                                    <p class="name">Eva Foster</p>
                                    <p class="role">Administradora de Base de Datos</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Eva Foster', 'Administradora de Base de Datos', '49', 'active')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=68");'></div>
                                <div class="card-text">
                                    <p class="name">Frank Green</p>
                                    <p class="role">Ciberseguridad</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Frank Green', 'Ciberseguridad', '68', 'active')">Ver detalle</a>
                            </div>
                        </div>
                        
                        <!-- Grid de empleados inactivos -->
                        <div id="inactive-employees-grid" class="inventory-grid" style="display: none;">
                            <div class="user-card shadow-sm inactive-employee">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=1");'></div>
                                <div class="card-text">
                                    <p class="name">Grace Hall</p>
                                    <p class="role">Ex-Desarrolladora</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Grace Hall', 'Ex-Desarrolladora', '1', 'inactive')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm inactive-employee">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=12");'></div>
                                <div class="card-text">
                                    <p class="name">Henry Irwin</p>
                                    <p class="role">Ex-Gerente de Proyectos</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Henry Irwin', 'Ex-Gerente de Proyectos', '12', 'inactive')">Ver detalle</a>
                            </div>
                            <div class="user-card shadow-sm inactive-employee">
                                <div class="card-avatar" style='background-image: url("https://i.pravatar.cc/150?img=47");'></div>
                                <div class="card-text">
                                    <p class="name">Ivy Jackson</p>
                                    <p class="role">Ex-Probadora de QA</p>
                                </div>
                                <a class="btn-primary-dark" href="#" onclick="event.preventDefault(); showProfileView('Ivy Jackson', 'Ex-Probadora de QA', '47', 'inactive')">Ver detalle</a>
                            </div>
                        </div>

                        <!-- Nueva sección de Inventario -->
                        <div id="inventory-section" style="display: none;">
                            <!-- Barra de búsqueda y botones -->
                            <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                <div class="search-container shadow-sm" style="flex: 1; min-width: 250px; margin: 0;">
                                    <span class="material-symbols-outlined search-icon">search</span>
                                    <input class="search-input" id="inventory-search-input" placeholder="Buscar por dispositivo, ID o usuario..." type="text"/>
                                </div>
                                <button class="btn-outline" style="white-space: nowrap;">
                                    <span class="material-symbols-outlined icon-base">filter_alt</span>
                                    Filtrar por estado
                                </button>
                                <button class="btn-primary-highlight" style="white-space: nowrap;" onclick="openAddDeviceModal()">
                                    <span class="material-symbols-outlined icon-base">add</span>
                                    Añadir Dispositivo
                                </button>
                            </div>

                            <!-- Sección de Monitores -->
                            <div class="inventory-category">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('monitors')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">computer</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">Monitores</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">2</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="monitors-icon">expand_less</span>
                                </div>
                                
                                <div id="monitors-grid" class="inventory-grid" style="grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Monitor Dell U2721DE</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: MON-00123</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Alice Johnson</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                            <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                            </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Monitor LG 27UL500</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: MON-00124</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">N/A</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #fff3cd; color: #856404; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">En Almacén</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                                </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección de Teclados -->
                            <div class="inventory-category" style="margin-top: 2rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('keyboards')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">keyboard</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">Teclados</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">1</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="keyboards-icon">expand_more</span>
                                </div>
                                
                                <div id="keyboards-grid" class="inventory-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Teclado Mecánico Keychron K2</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: KBD-00045</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Bob Smith</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                            <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                            </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección de Mouses -->
                            <div class="inventory-category" style="margin-top: 2rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('mouses')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">mouse</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">Mouses</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">1</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="mouses-icon">expand_more</span>
                                </div>
                                
                                <div id="mouses-grid" class="inventory-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Mouse Logitech MX Master 3</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: MOU-00089</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Carol Williams</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                            <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                            </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección de CPU -->
                            <div class="inventory-category" style="margin-top: 2rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('cpus')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">memory</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">CPU</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">2</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="cpus-icon">expand_more</span>
                                </div>
                                
                                <div id="cpus-grid" class="inventory-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Dell OptiPlex 7090</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: CPU-00201</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">David Evans</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                                </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">HP EliteDesk 800 G6</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: CPU-00202</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">N/A</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #fff3cd; color: #856404; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">En Almacén</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                                </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección de Diademas -->
                            <div class="inventory-category" style="margin-top: 2rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('headphones')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">headphones</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">Diademas</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">2</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="headphones-icon">expand_more</span>
                                </div>
                                
                                <div id="headphones-grid" class="inventory-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Sony WH-1000XM5</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: HDP-00056</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Ana Garcia</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                                </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">Bose QuietComfort 45</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: HDP-00057</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Ben Carter</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                            <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                            </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección de Antenas WiFi -->
                            <div class="inventory-category" style="margin-top: 2rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; cursor: pointer;" onclick="toggleCategory('wifi')">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span class="material-symbols-outlined">wifi</span>
                                        <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">Antenas WiFi</h3>
                                        <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500;">1</span>
                                    </div>
                                    <span class="material-symbols-outlined" id="wifi-icon">expand_more</span>
                                </div>
                                
                                <div id="wifi-grid" class="inventory-grid" style="display: none; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                                    <div class="user-card shadow-sm">
                                        <div style="padding: 1rem;">
                                            <h4 style="font-weight: 600; margin: 0 0 0.25rem 0;">TP-Link Archer TX3000E</h4>
                                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0 0 0.75rem 0;">ID: WIF-00015</p>
                                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 0.75rem;">
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Usuario Asignado:</span>
                                                    <span style="font-size: 0.875rem; font-weight: 500;">Frank Green</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between;">
                                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">Estado:</span>
                                                    <span style="background: #d4edda; color: #155724; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Asignado</span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;">
                                            <button onclick="openEditDeviceModal(this)" style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <span class="material-symbols-outlined" style="font-size: 1.25rem;">edit</span>
                                            </button>
                                                <button style="flex: 1; padding: 0.5rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                    <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="view-profile" class="view-section profile-container shadow-sm">
                        
                        <p class="breadcrumbs">Directorio / Usuarios / <span id="profile-name-short">Usuario</span></p>

                        <div class="mt-4">
                            <a class="back-to-directory" href="#" onclick="event.preventDefault(); showDirectoryView()">← Volver al Directorio</a>
                        </div>

                        <div class="profile-header">
                            <div class="profile-main-info">
                                <div id="profile-avatar" class="profile-avatar-lg" style='background-image: url("https://i.pravatar.cc/150?img=9");'></div>
                                <div>
                                    <h2 id="profile-name" class="profile-name">Nombre Usuario</h2>
                                    <p id="profile-role" class="profile-role">Cargo</p>
                                    <span id="status-badge" class="status-badge">Activo</span>
                                </div>
                            </div>
                            <div class="profile-actions">
                                <button class="btn-outline" onclick="showEditProfileView()">
                                    <span class="material-symbols-outlined icon-base">edit</span> Editar Perfil
                                </button>
                                <button class="btn-primary-highlight">
                                    <span class="material-symbols-outlined icon-base">add</span> Asignar Equipo
                                </button>
                            </div>
                        </div>

                    <!-- Información Personal -->
                        <div class="section-content">
                            <h3 class="section-title">Información Personal</h3>
                            <div class="info-data-grid-2col">
                                <!-- 1. Nombre -->
                                <div class="info-grid-item">
                                    <div class="info-label">Nombre Completo</div>
                                    <div class="info-value">Ana Sofía García Pérez</div>
                                </div>
                                
                                <!-- 2. Fecha de Nacimiento -->
                                <div class="info-grid-item">
                                    <div class="info-label">Fecha de Nacimiento</div>
                                    <div class="info-value">10/05/1985</div>
                                </div>
                                
                                <!-- 3. Cédula -->
                                <div class="info-grid-item">
                                    <div class="info-label">Cédula</div>
                                    <div class="info-value">V-12.345.678</div>
                                </div>
                                
                                <!-- 4. Celular -->
                                <div class="info-grid-item">
                                    <div class="info-label">Celular</div>
                                    <div class="info-value">+58 412-1234567</div>
                                </div>
                                
                                <!-- 5. Correo -->
                                <div class="info-grid-item">
                                    <div class="info-label">Correo</div>
                                    <div class="info-value">ana.garcia.p@email.com</div>
                                </div>
                                
                                <!-- 6. Dirección -->
                                <div class="info-grid-item">
                                    <div class="info-label">Dirección de Residencia</div>
                                    <div class="info-value">Calle Falsa 123, Apto 4B</div>
                                </div>
                                
                                <!-- 7. Localidad -->
                                <div class="info-grid-item">
                                    <div class="info-label">Localidad, Barrio</div>
                                    <div class="info-value">Bosa, La Independencia</div>
                                </div>
                                
                                <!-- 8. Ciudad -->
                                <div class="info-grid-item">
                                    <div class="info-label">Ciudad / Departamento</div>
                                    <div class="info-value">Bogotá D.C.</div>
                                </div>
                                
                                <!-- 9. Tipo de Sangre -->
                                <div class="info-grid-item">
                                    <div class="info-label">Tipo de Sangre</div>
                                    <div class="info-value">O+</div>
                                </div>
                                
                                <!-- 10. Hijos -->
                                <div class="info-grid-item">
                                    <div class="info-label">Número de Hijos</div>
                                    <div class="info-value">2</div>
                                </div>
                                
                                <!-- 11. Persona de Contacto -->
                                <div class="info-grid-item">
                                    <div class="info-label">Persona de Contacto en Emergencias</div>
                                    <div class="info-value">Carlos Pérez</div>
                                </div>
                                
                                <!-- 12. Teléfono de Emergencia -->
                                <div class="info-grid-item">
                                    <div class="info-label">Teléfono de Emergencia</div>
                                    <div class="info-value">+57 310-9876543</div>
                                </div>
                                
                                <!-- 13. Parentesco del Contacto -->
                                <div class="info-grid-item">
                                    <div class="info-label">Parentesco del Contacto de Emergencia</div>
                                    <div class="info-value">Padre</div>
                                </div>
                            </div>
                        </div>

                    <!-- Información Laboral -->
                        <div class="section-content">
                            <h3 class="section-title">Información de la Empresa</h3>
                            <div class="info-data-grid-2col">
                                <!-- Tipo de Contrato -->
                                
                                <!-- Cargo -->
                                <div class="info-grid-item">
                                    <div class="info-label">Cargo</div>
                                    <div class="info-value">Desarrollador Senior</div>
                                </div>
                                <!-- Área / Departamento -->
                                <div class="info-grid-item">
                                    <div class="info-label">Área / Departamento</div>
                                    <div class="info-value">Tecnología de la Información</div>
                                </div>
                                <!-- Jefe Inmediato -->
                                <div class="info-grid-item">
                                    <div class="info-label">Jefe Inmediato</div>
                                    <div class="info-value">Carlos Rodríguez</div>
                                </div>
                                 <!-- Jefe Inmediato -->
                                <div class="info-grid-item">
                                    <div class="info-label">Correo Corporativo</div>
                                    <div class="info-value">carlos.rodriguez@empresa.com</div>
                                </div>
                                <!-- Inicio de contrato -->
                                <div class="info-grid-item">
                                    <div class="info-label">Inicio de Contrato</div>
                                    <div class="info-value">15/01/2020</div>
                                </div>
                                <!-- ID BIOMETRICO -->
                                <div class="info-grid-item">
                                    <div class="info-label">ID Biométrico</div>
                                    <div class="info-value">BIO-2023-001234</div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestañas Hardware / Software / Historial -->
                        <div class="tabs-container">
                            <button class="tab-btn active" onclick="switchTab('hardware', this)">Hardware</button>
                            <button class="tab-btn" onclick="switchTab('software', this)">Software</button>
                            <button class="tab-btn" onclick="switchEditTab('history', this)">Historial</button>
                        </div>
                        <!-- Esto se debe actualizar cuando el Hardware se establezca -->
                        <!-- Tab Hardware -->
                        <div id="tab-hardware" class="tab-content active">
                            <div class="info-data-grid-2col">
                                <div class="info-grid-item">
                                    <div class="info-label">Procesador</div>
                                    <div class="info-value">Intel Core i7 12th Gen</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Memoria RAM</div>
                                    <div class="info-value">16 GB DDR4</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Almacenamiento</div>
                                    <div class="info-value">512 GB SSD NVMe</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Tarjeta Gráfica</div>
                                    <div class="info-value">NVIDIA RTX 3050</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Antena Wifi</div>
                                    <div class="info-value">Integrada</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Mouse</div>
                                    <div class="info-value">Logitech G203</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Teclado</div>
                                    <div class="info-value">Mecánico Redragon</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Diadema</div>
                                    <div class="info-value">Sony WH-1000XM5</div>
                                </div>
                            </div>
                        </div>
                        <!-- Esto se debe actualizar cuando el software se establezca -->
                        <!-- Tab Software -->
                        <div id="tab-software" class="tab-content">
                            <div class="info-data-grid-2col">
                                <div class="info-grid-item">
                                    <div class="info-label">Microsoft Office 365</div>
                                    <div class="info-value">Licencia E3</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Adobe Creative Cloud</div>
                                    <div class="info-value">Todas las aplicaciones</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Slack</div>
                                    <div class="info-value">Plan Pro</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Figma</div>
                                    <div class="info-value">Licencia Profesional</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">Jira</div>
                                    <div class="info-value">Acceso Completo</div>
                                </div>
                                <div class="info-grid-item">
                                    <div class="info-label">GitLab</div>
                                    <div class="info-value">Rol de Mantenedor</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Historial -->
                        <div id="tab-history" class="tab-content">
                            <!-- Botón de Exportación -->
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                <button onclick="exportHistoryToExcel()" class="btn-primary-highlight" type="button">
                                    <span class="material-symbols-outlined icon-base">download</span>
                                    Exportar a Excel
                                </button>
                            </div>

                            <!-- Tabla de Historial -->
                            <div class="table-container">
                                <table class="data-table" id="history-table">
                                    <thead>
                                        <tr>
                                            <th>FECHA</th>
                                            <th>COMPONENTE</th>
                                            <th>VALOR ANTERIOR</th>
                                            <th>VALOR NUEVO</th>
                                            <th>REALIZADO POR</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>15/05/2024</td>
                                            <td>RAM</td>
                                            <td>8 GB</td>
                                            <td>16 GB</td>
                                            <td>Admin TI</td>
                                        </tr>
                                        <tr>
                                            <td>10/01/2024</td>
                                            <td>Mouse</td>
                                            <td>Apple Magic Mouse</td>
                                            <td>Logitech MX Master 3S</td>
                                            <td>Admin TI</td>
                                        </tr>
                                        <tr>
                                            <td>10/01/2024</td>
                                            <td>Diadema</td>
                                            <td>N/A</td>
                                            <td>Sony WH-1000XM5</td>
                                            <td>Admin TI</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="mt-4">
                            <a class="back-to-directory" href="#" onclick="event.preventDefault(); showDirectoryView()">← Volver al Directorio</a>
                        </div>
                    </div>
                    
                        <!-- Vista de Edición -->
                    <div id="view-edit-profile" class="view-section profile-container shadow-sm">
                        <p class="breadcrumbs">Directorio / Usuarios / <span id="edit-profile-name-short">Usuario</span></p>

                        <div class="profile-header">
                            <div class="profile-main-info">
                                <div id="edit-profile-avatar" class="profile-avatar-lg" style='background-image: url("https://i.pravatar.cc/150?img=9");'></div>
                                <div>
                                    <h2 id="edit-profile-name-full" class="profile-name">Editar Perfil de Ana García</h2>
                                    <p class="profile-role">Modifique la información personal y de hardware del usuario.</p>
                                </div>
                            </div>
                            <div class="profile-actions">
                                <button class="btn-outline" onclick="showProfileViewFromEdit()">Cancelar</button>
                                <button class="btn-primary-highlight">
                                    <span class="material-symbols-outlined icon-base">save</span>
                                    Guardar Cambios
                                </button>
                            </div>
                        </div>
                        
                        <!-- Información Personal -->
                        <div class="section-content">
                            <h3 class="section-title">Información Personal</h3>
                            <div class="edit-form-grid">
                                <div class="form-input-group">
                                    <label for="edit-nombre-completo" class="form-label">Nombre Completo</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-nombre-completo" type="text" value="Ana Sofía García Pérez"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-fecha-nacimiento" class="form-label">Fecha de Nacimiento</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-fecha-nacimiento" type="date" value="1985-05-10"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-cedula" class="form-label">Cédula</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-cedula" type="text" value="V-12.345.678"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-celular" class="form-label">Celular</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-celular" type="tel" value="+58 412-1234567"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-correo" class="form-label">Correo</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-correo" type="email" value="ana.garcia.p@email.com"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-direccion" class="form-label">Dirección de Residencia</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-direccion" type="text" value="Calle Falsa 123, Apto 4B"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-localidad" class="form-label">Localidad, Barrio</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-localidad" type="text" value="Bosa, La Independencia"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-ciudad" class="form-label">Ciudad / Departamento</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-ciudad" type="text" value="Bogotá D.C."/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-tipo-sangre" class="form-label">Tipo de Sangre</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-tipo-sangre" type="text" value="O+"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-num-hijos" class="form-label">Número de Hijos</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-num-hijos" type="number" value="2"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-contacto-emergencia" class="form-label">Persona de Contacto en Emergencias</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-contacto-emergencia" type="text" value="Carlos Pérez"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-telefono-emergencia" class="form-label">Teléfono de Emergencia</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-telefono-emergencia" type="tel" value="+57 310-9876543"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-parentesco-emergencia" class="form-label">Parentesco del Contacto de Emergencia</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-parentesco-emergencia" type="text" value="Padre"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        

                        <!-- Información laboral -->
                        <div class="section-content">
                            <h3 class="section-title">Información laboral</h3>
                            <div class="edit-form-grid">
                                <div class="form-input-group">
                                    <label for="edit-cargo" class="form-label">Cargo</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-cargo" type="text" value="Desarrollador Senior"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-area-departamento" class="form-label">Área / Departamento</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-area-departamento" type="text" value="Tecnología de la Información"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-jefe-inmediato" class="form-label">Jefe Inmediato</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-jefe-inmediato" type="text" value="Carlos Rodríguez"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-correo-corporativo" class="form-label">Correo Corporativo</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-correo-corporativo" type="text" value="correo@empresa.com"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-inicio-contrato" class="form-label">Inicio de Contrato</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-inicio-contrato" type="date" value="2020-01-15"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                                <div class="form-input-group">
                                    <label for="edit-id-biometrico" class="form-label">ID Biométrico</label>
                                    <div class="input-with-icon">
                                        <input class="form-input" id="edit-id-biometrico" type="text" value="BIO-2023-001234"/>
                                        <span class="material-symbols-outlined input-icon">edit</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pestañas: Hardware, Software, Historial -->
                        <div class="section-content">
                            <div class="tabs-container">
                                <button class="tab-btn active" onclick="switchEditTab('hardware', this)">Hardware</button>
                                <button class="tab-btn" onclick="switchEditTab('software', this)">Software</button>
                            </div>

                            <!-- Tab Hardware -->
                            <div id="tab-edit-hardware" class="tab-content active">
                                <div class="edit-form-grid">
                                    <div class="form-input-group">
                                        <label for="edit-procesador" class="form-label">Procesador</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-procesador" type="text" value="Intel Core i7 12th Gen"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-ram" class="form-label">Memoria RAM</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-ram" type="text" value="16 GB DDR4"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-almacenamiento" class="form-label">Almacenamiento</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-almacenamiento" type="text" value="512 GB SSD NVMe"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-gpu" class="form-label">Tarjeta Gráfica</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-gpu" type="text" value="NVIDIA RTX 3050"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-antena-wifi" class="form-label">Antena Wifi</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-antena-wifi" type="text" value="Integrada"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-mouse" class="form-label">Mouse</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-mouse" type="text" value="Logitech G203"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-teclado" class="form-label">Teclado</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-teclado" type="text" value="Mecánico Redragon"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-diadema" class="form-label">Diadema</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-diadema" type="text" value="Sony WH-1000XM5"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab Software -->
                            <div id="tab-edit-software" class="tab-content">
                                <div class="edit-form-grid">
                                    <div class="form-input-group">
                                        <label for="edit-office365" class="form-label">Microsoft Office 365</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-office365" type="text" value="Licencia E3"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-adobe" class="form-label">Adobe Creative Cloud</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-adobe" type="text" value="Todas las aplicaciones"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-slack" class="form-label">Slack</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-slack" type="text" value="Plan Pro"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-figma" class="form-label">Figma</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-figma" type="text" value="Licencia Profesional"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-jira" class="form-label">Jira</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-jira" type="text" value="Acceso Completo"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                    <div class="form-input-group">
                                        <label for="edit-gitlab" class="form-label">GitLab</label>
                                        <div class="input-with-icon">
                                            <input class="form-input" id="edit-gitlab" type="text" value="Rol de Mantenedor"/>
                                            <span class="material-symbols-outlined input-icon">edit</span>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- Tab Historial -->
                            <div id="tab-edit-history" class="tab-content">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Componente</th>
                                                <th>Valor Anterior</th>
                                                <th>Valor Nuevo</th>
                                                <th>Realizado por</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>15/05/2024</td>
                                                <td>RAM</td>
                                                <td>8 GB</td>
                                                <td>16 GB</td>
                                                <td>Admin TI</td>
                                            </tr>
                                            <tr>
                                                <td>10/01/2024</td>
                                                <td>Mouse</td>
                                                <td>Apple Magic Mouse</td>
                                                <td>Logitech MX Master 3S</td>
                                                <td>Admin TI</td>
                                            </tr>
                                            <tr>
                                                <td>10/01/2024</td>
                                                <td>Diadema</td>
                                                <td>N/A</td>
                                                <td>Sony WH-1000XM5</td>
                                                <td>Admin TI</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                <!-- ============================================ -->
                <!-- MODAL DE AÑADIR DISPOSITIVO -->
                <!-- Agregar este bloque ANTES del cierre de </main> -->
                <!-- ============================================ -->

                <!-- Modal Overlay - Fondo oscuro que cubre toda la pantalla -->
                <div id="add-device-modal" class="modal-overlay" style="display: none;">
                    <!-- Modal Content - Contenedor principal del modal -->
                    <div class="modal-content modal-device">
                        
                        <!-- HEADER DEL MODAL -->
                        <div class="modal-header-device">
                            <div>
                                <h2 class="modal-title">Añadir Dispositivo(s)</h2>
                                <p class="modal-subtitle-device">Añade un dispositivo individual o múltiples dispositivos al inventario.</p>
                            </div>
                            <!-- Botón para cerrar el modal -->
                            <button class="modal-close-btn" onclick="closeAddDeviceModal()">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- PESTAÑAS DE SELECCIÓN: Individual / Múltiples -->
                        <div class="device-tabs-container">
                            <button class="device-tab-btn active" onclick="switchDeviceTab('individual', this)">
                                Añadir Dispositivo Individual
                            </button>
                            <button class="device-tab-btn" onclick="switchDeviceTab('multiple', this)">
                                Añadir Múltiples Dispositivos
                            </button>
                        </div>

                        <!-- ============================================ -->
                        <!-- FORMULARIO: DISPOSITIVO INDIVIDUAL -->
                        <!-- ============================================ -->
                        <div id="device-tab-individual" class="device-tab-content active">
                            
                            <!-- Campo: Nombre del Dispositivo -->
                            <div class="form-input-group">
                                <label class="form-label">Nombre</label>
                                <input class="form-input" type="text" placeholder="Ej: Monitor Dell U2721DE" />
                            </div>

                            <!-- Campo: Identificador Único (ID) -->
                            <div class="form-input-group">
                                <label class="form-label">Identificador Único (ID)</label>
                                <input class="form-input" type="text" placeholder="Ej: MON-00125" />
                            </div>

                            <!-- Campo: Número de Serie -->
                            <div class="form-input-group">
                                <label class="form-label">Número de Serie</label>
                                <input class="form-input" type="text" placeholder="Ej: SN-456-134-98" />
                            </div>

                            <!-- Campo: Tipo de Dispositivo (Dropdown) -->
                            <div class="form-input-group">
                                <label class="form-label">Tipo de Dispositivo</label>
                                <select class="form-input">
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="monitor">Monitor</option>
                                    <option value="keyboard">Teclado</option>
                                    <option value="mouse">Mouse</option>
                                    <option value="cpu">CPU</option>
                                    <option value="headphones">Diadema</option>
                                    <option value="wifi">Antena WiFi</option>
                                </select>
                            </div>

                            <!-- Campo: Estado del Dispositivo (Dropdown) -->
                            <div class="form-input-group">
                                <label class="form-label">Estado</label>
                                <select class="form-input">
                                    <option value="storage">En Almacén</option>
                                    <option value="assigned">Asignado</option>
                                    <option value="maintenance">En Mantenimiento</option>
                                    <option value="damaged">Dañado</option>
                                </select>
                            </div>

                            <!-- Campo: Usuario Asignado (Opcional - con búsqueda) -->
                            <div class="form-input-group">
                                <label class="form-label">Usuario Asignado (Opcional)</label>
                                <div class="input-with-icon">
                                    <input class="form-input" type="text" placeholder="Buscar empleado..." />
                                    <span class="material-symbols-outlined input-icon">search</span>
                                </div>
                            </div>

                            <!-- Botones de Acción -->
                            <div class="device-modal-actions">
                                <button class="btn-outline" onclick="closeAddDeviceModal()">
                                    Cancelar
                                </button>
                                <button class="btn-primary-highlight" onclick="submitIndividualDevice()">
                                    Añadir
                                </button>
                            </div>
                        </div>

                        <!-- ============================================ -->
                        <!-- FORMULARIO: MÚLTIPLES DISPOSITIVOS -->
                        <!-- ============================================ -->
                        <div id="device-tab-multiple" class="device-tab-content">
                            
                            <!-- Campo: Tipo de Dispositivo (Dropdown) -->
                            <div class="form-input-group">
                                <label class="form-label">Tipo de Dispositivo</label>
                                <select class="form-input">
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="monitor">Monitor</option>
                                    <option value="keyboard">Teclado</option>
                                    <option value="mouse">Mouse</option>
                                    <option value="cpu">CPU</option>
                                    <option value="headphones">Diadema</option>
                                    <option value="wifi">Antena WiFi</option>
                                </select>
                            </div>

                            <!-- Campo: Cantidad de Dispositivos -->
                            <div class="form-input-group">
                                <label class="form-label">Cantidad</label>
                                <input class="form-input" type="number" value="1" min="1" />
                            </div>

                            <!-- Campo: Número de Serie Inicial -->
                            <div class="form-input-group">
                                <label class="form-label">Número de Serie Inicial</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input class="form-input" type="text" placeholder="Ej: SN-456-13500" style="flex: 1;" />
                                    <!-- Checkbox para auto-incrementar números de serie -->
                                    <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; white-space: nowrap; font-size: 0.875rem;">
                                        <input type="checkbox" checked style="cursor: pointer;" />
                                        <span class="material-symbols-outlined" style="font-size: 1.25rem;">add_circle</span>
                                        Auto-incrementar
                                    </label>
                                </div>
                            </div>

                            <!-- Campo: Estado por Defecto -->
                            <div class="form-input-group">
                                <label class="form-label">Estado</label>
                                <select class="form-input">
                                    <option value="storage">En Almacén</option>
                                    <option value="assigned">Asignado</option>
                                    <option value="maintenance">En Mantenimiento</option>
                                    <option value="damaged">Dañado</option>
                                </select>
                            </div>

                            <!-- Botones de Acción -->
                            <div class="device-modal-actions">
                                <button class="btn-outline" onclick="closeAddDeviceModal()">
                                    Cancelar
                                </button>
                                <button class="btn-primary-highlight" onclick="submitMultipleDevices()">
                                    Generar y Añadir
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ============================================ -->
                <!-- MODAL DE EDICIÓN DE DISPOSITIVO -->
                <!-- ============================================ -->

                <div id="edit-device-modal" class="modal-overlay" style="display: none;">
                    <div class="modal-content modal-device-edit">
                        
                        <!-- HEADER DEL MODAL -->
                        <div class="modal-header-device">
                            <div>
                                <h2 class="modal-title">Editar Dispositivo</h2>
                                <p class="modal-subtitle-device">Modifica el estado o asignación del dispositivo seleccionado.</p>
                            </div>
                            <!-- Botón para cerrar el modal -->
                            <button class="modal-close-btn" onclick="closeEditDeviceModal()">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- CONTENIDO DEL FORMULARIO -->
                        <div class="edit-device-form">
                            
                            <!-- FILA 1: Nombre y ID (Solo lectura) -->
                            <div class="edit-device-row">
                                <div class="form-input-group">
                                    <label class="form-label">Nombre del Dispositivo</label>
                                    <input 
                                        class="form-input form-input-readonly" 
                                        type="text" 
                                        id="edit-device-name" 
                                        readonly 
                                    />
                                </div>
                                
                                <div class="form-input-group">
                                    <label class="form-label">Identificador Único (ID)</label>
                                    <input 
                                        class="form-input form-input-readonly" 
                                        type="text" 
                                        id="edit-device-id" 
                                        readonly 
                                    />
                                </div>
                            </div>

                            <!-- FILA 2: Número de Serie y Tipo (Solo lectura) -->
                            <div class="edit-device-row">
                                <div class="form-input-group">
                                    <label class="form-label">Número de Serie</label>
                                    <input 
                                        class="form-input form-input-readonly" 
                                        type="text" 
                                        id="edit-device-serial" 
                                        readonly 
                                        placeholder="No registrado"
                                    />
                                </div>
                                
                                <div class="form-input-group">
                                    <label class="form-label">Tipo de Dispositivo</label>
                                    <input 
                                        class="form-input form-input-readonly" 
                                        type="text" 
                                        id="edit-device-type" 
                                        readonly 
                                    />
                                </div>
                            </div>

                            <!-- FILA 3: Marca (Solo lectura) -->
                            <div class="edit-device-row">
                                <div class="form-input-group">
                                    <label class="form-label">Marca</label>
                                    <input 
                                        class="form-input form-input-readonly" 
                                        type="text" 
                                        id="edit-device-brand" 
                                        readonly 
                                        placeholder="No especificada"
                                    />
                                </div>
                                
                                <div class="form-input-group">
                                    <!-- Espacio vacío para mantener la estructura de 2 columnas -->
                                </div>
                            </div>

                            <!-- DIVISOR VISUAL -->
                            <div style="width: 100%; height: 1px; background: var(--border-color); margin: 1.5rem 0;"></div>

                            <!-- FILA 4: Estado y Usuario Asignado (EDITABLES) -->
                            <div class="edit-device-row">
                                <div class="form-input-group">
                                    <label class="form-label">
                                        Estado 
                                        <span style="color: var(--accent-color); font-weight: 600;">*</span>
                                    </label>
                                    <select class="form-input" id="edit-device-status">
                                        <option value="storage">En Almacén</option>
                                        <option value="assigned">Asignado</option>
                                        <option value="maintenance">En Mantenimiento</option>
                                        <option value="damaged">Dañado</option>
                                    </select>
                                </div>
                                
                                <div class="form-input-group">
                                    <label class="form-label">Usuario Asignado (Opcional)</label>
                                    <div class="input-with-icon">
                                        <input 
                                            class="form-input" 
                                            type="text" 
                                            id="edit-device-user" 
                                            placeholder="Buscar empleado..." 
                                        />
                                        <span class="material-symbols-outlined input-icon">search</span>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- BOTONES DE ACCIÓN -->
                        <div class="device-modal-actions">
                            <button class="btn-outline" onclick="closeEditDeviceModal()">
                                Cancelar
                            </button>
                            <button class="btn-primary-highlight" onclick="saveDeviceChanges()">
                                <span class="material-symbols-outlined icon-base">check</span>
                                Guardar Cambios
                            </button>
                        </div>

                    </div>
                </div>
        </main>
    </div>
                <!-- ============================================ -->
                <!-- MODAL DE CATÁLOGO DE HARDWARE -->
                <!-- ============================================ -->

                <div id="hardware-catalog-modal" class="modal-overlay" style="display: none; z-index: 3000;">
                    <div class="modal-content" style="max-width: 1200px; width: 95%; max-height: 90vh; overflow-y: auto;">
                        
                        <!-- HEADER DEL CATÁLOGO -->
                        <div class="catalog-header">
                            <div>
                                <h2 class="catalog-title">Catálogo de Dispositivos para Asignación</h2>
                                <p class="catalog-subtitle">Selecciona el equipo que deseas asignar al empleado.</p>
                            </div>
                            <button class="modal-close-btn" onclick="closeCatalogModal()">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- BARRA DE BÚSQUEDA Y FILTRO -->
                        <div class="catalog-filters">
                            <div class="search-container-catalog">
                                <span class="material-symbols-outlined search-icon-catalog">search</span>
                                <input 
                                    type="text" 
                                    class="search-input-catalog" 
                                    id="catalog-search-input"
                                    placeholder="Buscar por nombre, modelo o serial..."
                                />
                            </div>
                            <select class="filter-select-catalog" id="catalog-category-filter">
                                <option value="all">Todas las categorías</option>
                                <option value="laptop">Laptop</option>
                                <option value="monitor">Monitor</option>
                                <option value="mouse">Mouse</option>
                                <option value="keyboard">Teclado</option>
                                <option value="headset">Auriculares</option>
                            </select>
                        </div>

                        <!-- GRID DE DISPOSITIVOS -->
                        <div class="catalog-grid" id="catalog-devices-grid">
                            <!-- DISPOSITIVO 1: Laptop -->
                            <div class="catalog-card" data-category="laptop" data-device-id="LAPTOP-001">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">Laptop Pro 14"</h3>
                                    <p class="catalog-card-category">Laptop</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('LAPTOP-001', this)">
                                    Asignar
                                </button>
                            </div>

                            <!-- DISPOSITIVO 2: Monitor -->
                            <div class="catalog-card" data-category="monitor" data-device-id="MON-001">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">UltraSharp 27"</h3>
                                    <p class="catalog-card-category">Monitor</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('MON-001', this)">
                                    Asignar
                                </button>
                            </div>

                            <!-- DISPOSITIVO 3: Mouse -->
                            <div class="catalog-card" data-category="mouse" data-device-id="MOUSE-001">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">Wireless Mouse</h3>
                                    <p class="catalog-card-category">Mouse</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('MOUSE-001', this)">
                                    Asignar
                                </button>
                            </div>

                            <!-- DISPOSITIVO 4: Auriculares -->
                            <div class="catalog-card" data-category="headset" data-device-id="HEAD-001">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">Noise-Cancelling Headset</h3>
                                    <p class="catalog-card-category">Auriculares</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('HEAD-001', this)">
                                    Asignar
                                </button>
                            </div>

                            <!-- DISPOSITIVO 5: Teclado -->
                            <div class="catalog-card" data-category="keyboard" data-device-id="KEY-001">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">Mechanical Keyboard RGB</h3>
                                    <p class="catalog-card-category">Teclado</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('KEY-001', this)">
                                    Asignar
                                </button>
                            </div>

                            <!-- DISPOSITIVO 6: Laptop (otro modelo) -->
                            <div class="catalog-card" data-category="laptop" data-device-id="LAPTOP-002">
                                <div class="catalog-card-body">
                                    <h3 class="catalog-card-title">Laptop Business 15"</h3>
                                    <p class="catalog-card-category">Laptop</p>
                                    <div class="catalog-card-status">
                                        <span class="status-dot available"></span>
                                        <span class="status-text">Disponible</span>
                                    </div>
                                </div>
                                <button class="catalog-btn-assign" onclick="selectDevice('LAPTOP-002', this)">
                                    Asignar
                                </button>
                            </div>
                        </div>

                        <!-- BOTONES DE ACCIÓN INFERIORES -->
                        <div class="catalog-footer">
                            <button class="catalog-btn-cancel" onclick="closeCatalogModal()">
                                Cancelar
                            </button>
                            <button class="catalog-btn-confirm" id="confirm-assignment-btn" onclick="confirmHardwareAssignment()">
                                Confirmar Asignación
                                <span class="material-symbols-outlined" style="font-size: 1.25rem; margin-left: 0.5rem;">arrow_forward</span>
                            </button>
                        </div>

                    </div>
                </div>
                <!-- ============================================ -->
                <!-- MODAL DE CREAR NUEVO SOFTWARE -->
                <!-- ============================================ -->

                <div id="create-software-modal" class="modal-overlay" style="display: none; z-index: 2000;">
                    <div class="modal-content modal-device">
                        
                        <!-- HEADER DEL MODAL -->
                        <div class="modal-header-device">
                            <div>
                                <h2 class="modal-title">Crear Nuevo Software</h2>
                                <p class="modal-subtitle-device">Completa la información del software para agregarlo al inventario.</p>
                            </div>
                            <button class="modal-close-btn" onclick="closeCreateSoftwareModal()">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- CONTENIDO DEL FORMULARIO -->
                        <div style="padding: 0 1.5rem 1.5rem;">
                            
                            <!-- Sección: Información Principal -->
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #370c31; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">
                                    Información principal
                                </h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <!-- Nombre del Software -->
                                    <div class="form-input-group">
                                        <label class="form-label">Nombre del Software</label>
                                        <input 
                                            class="form-input" 
                                            type="text" 
                                            id="software-name" 
                                            placeholder="Ej: Microsoft Office" 
                                        />
                                    </div>

                                    <!-- Versión -->
                                    <div class="form-input-group">
                                        <label class="form-label">Versión</label>
                                        <input 
                                            class="form-input" 
                                            type="text" 
                                            id="software-version" 
                                            placeholder="Ej: 365" 
                                        />
                                    </div>
                                </div>

                                <!-- Descripción Breve -->
                                <div class="form-input-group">
                                    <label class="form-label">Descripción breve</label>
                                    <textarea 
                                        class="form-input" 
                                        id="software-description" 
                                        rows="3" 
                                        placeholder="Suite de ofimática para productividad..."
                                        style="resize: vertical; font-family: inherit;"
                                    ></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <!-- Categoría -->
                                    <div class="form-input-group">
                                        <label class="form-label">Categoría</label>
                                        <select class="form-input" id="software-category">
                                            <option value="">Seleccionar...</option>
                                            <option value="ofimatica">Ofimática</option>
                                            <option value="diseno">Diseño</option>
                                            <option value="desarrollo">Desarrollo</option>
                                            <option value="comunicacion">Comunicación</option>
                                            <option value="gestion">Gestión de Proyectos</option>
                                            <option value="seguridad">Seguridad</option>
                                            <option value="otro">Otro</option>
                                        </select>
                                    </div>

                                    <!-- Área Usuaria -->
                                    <div class="form-input-group">
                                        <label class="form-label">Área usuaria</label>
                                        <select class="form-input" id="software-area">
                                            <option value="">Seleccionar...</option>
                                            <option value="tics">TICS</option>
                                            <option value="marketing">Marketing</option>
                                            <option value="rrhh">Recursos Humanos</option>
                                            <option value="ventas">Ventas</option>
                                            <option value="general">General</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Separador -->
                            <div style="width: 100%; height: 1px; background: var(--border-color); margin: 1.5rem 0;"></div>

                            <!-- Sección: Información de Licencia -->
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #370c31; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">
                                    Información de licencia
                                </h3>

                                <!-- Tipo de Licencia (Radio Buttons) -->
                                <div class="form-input-group" style="margin-bottom: 1rem;">
                                    <label class="form-label">Tipo de licencia</label>
                                    <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="radio" name="license-type" value="pago" id="license-pago" />
                                            <span style="font-size: 0.9rem;">Pago</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="radio" name="license-type" value="gratuito" id="license-gratuito" />
                                            <span style="font-size: 0.9rem;">Gratuito</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="radio" name="license-type" value="opensource" id="license-opensource" />
                                            <span style="font-size: 0.9rem;">Open Source</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="radio" name="license-type" value="suscripcion" id="license-suscripcion" />
                                            <span style="font-size: 0.9rem;">Suscripción</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="radio" name="license-type" value="perpetua" id="license-perpetua" />
                                            <span style="font-size: 0.9rem;">Perpetua</span>
                                        </label>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <!-- Plan -->
                                    <div class="form-input-group">
                                        <label class="form-label">Plan</label>
                                        <select class="form-input" id="software-plan">
                                            <option value="free">Free</option>
                                            <option value="basic">Basic</option>
                                            <option value="pro">Pro</option>
                                            <option value="enterprise">Enterprise</option>
                                            <option value="custom">Personalizado</option>
                                        </select>
                                    </div>

                                    <!-- Costo Mensual/Anual -->
                                    <div class="form-input-group">
                                        <label class="form-label">Costo mensual/anual</label>
                                        <input 
                                            class="form-input" 
                                            type="text" 
                                            id="software-cost" 
                                            placeholder="Ej: 99.99 USD" 
                                        />
                                    </div>
                                </div>

                                <!-- NUEVO CAMPO: Período de Facturación -->
                                <div class="form-input-group">
                                    <label class="form-label">Período de facturación</label>
                                    <div style="display: flex; gap: 1.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="mensual" 
                                                id="billing-monthly"
                                            />
                                            <span style="font-size: 0.9rem;">Mensual</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="trimestral" 
                                                id="billing-quarterly"
                                            />
                                            <span style="font-size: 0.9rem;">Trimestral</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="semestral" 
                                                id="billing-biannual"
                                            />
                                            <span style="font-size: 0.9rem;">Semestral</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="anual" 
                                                id="billing-yearly"
                                            />
                                            <span style="font-size: 0.9rem;">Anual</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="unico" 
                                                id="billing-onetime"
                                            />
                                            <span style="font-size: 0.9rem;">Pago único</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="billing-period" 
                                                value="gratuito" 
                                                id="billing-free"
                                            />
                                            <span style="font-size: 0.9rem;">Gratuito</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Separador -->
                            <div style="width: 100%; height: 1px; background: var(--border-color); margin: 1.5rem 0;"></div>

                            <!--  NUEVA SECCIÓN: CREDENCIALES DE ACCESO -->
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #370c31; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">
                                    Credenciales de acceso
                                </h3>

                                <!-- Tipo de Autenticación -->
                                <div class="form-input-group" style="margin-bottom: 1rem;">
                                    <label class="form-label">Tipo de autenticación</label>
                                    <div style="display: flex; gap: 2rem; margin-top: 0.5rem;">
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="auth-type" 
                                                value="credentials" 
                                                id="auth-credentials"
                                                checked
                                                onchange="toggleAuthFields('credentials')"
                                            />
                                            <span style="font-size: 0.9rem;">Correo y contraseña</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input 
                                                type="radio" 
                                                name="auth-type" 
                                                value="google" 
                                                id="auth-google"
                                                onchange="toggleAuthFields('google')"
                                            />
                                            <span style="font-size: 0.9rem;">Cuenta de Google</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Campos: Correo y Contraseña (por defecto visible) -->
                                <div id="credentials-fields">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div class="form-input-group">
                                            <label class="form-label">
                                                Correo electrónico
                                                <span style="color: #e74c3c; font-weight: 600;">*</span>
                                            </label>
                                            <div class="input-with-icon">
                                                <input 
                                                    class="form-input" 
                                                    type="email" 
                                                    id="software-email" 
                                                    placeholder="usuario@empresa.com"
                                                />
                                                <span class="material-symbols-outlined input-icon">email</span>
                                            </div>
                                        </div>

                                        <div class="form-input-group">
                                            <label class="form-label">
                                                Contraseña
                                                <span style="color: #e74c3c; font-weight: 600;">*</span>
                                            </label>
                                            <div class="input-with-icon">
                                                <input 
                                                    class="form-input" 
                                                    type="password" 
                                                    id="software-password" 
                                                    placeholder="••••••••"
                                                />
                                                <span class="material-symbols-outlined input-icon">lock</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Campos: Cuenta de Google (inicialmente oculto) -->
                                <div id="google-fields" style="display: none;">
                                    <div class="form-input-group">
                                        <label class="form-label">
                                            Correo de Google asociado
                                            <span style="color: #e74c3c; font-weight: 600;">*</span>
                                        </label>
                                        <div class="input-with-icon">
                                            <input 
                                                class="form-input" 
                                                type="email" 
                                                id="software-google-email" 
                                                placeholder="ejemplo@gmail.com"
                                            />
                                            <span class="material-symbols-outlined input-icon">account_circle</span>
                                        </div>
                                        <small style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.5rem; display: block;">
                                            Especifica el correo de Google con el que se inicia sesión en este software
                                        </small>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- BOTONES DE ACCIÓN -->
                        <div class="device-modal-actions" style="padding: 1.5rem; border-top: 1px solid var(--border-color);">
                            <button class="btn-outline" onclick="closeCreateSoftwareModal()" type="button">
                                Cancelar
                            </button>
                            <button class="btn-primary-highlight" onclick="saveSoftware()" type="button">
                                <span class="material-symbols-outlined icon-base">check</span>
                                Guardar Software
                            </button>
                        </div>

                    </div>
                </div>
            
    <script>
        // Referencias a elementos
        const dirView = document.getElementById('view-directory');
        const profileView = document.getElementById('view-profile');
        const editProfileView = document.getElementById('view-edit-profile');
        const activeEmployeesGrid = document.getElementById('active-employees-grid');
        const inactiveEmployeesGrid = document.getElementById('inactive-employees-grid');
        const inventorySection = document.getElementById('inventory-section');
        const searchInput = document.getElementById('search-input');
        const inventorySearchInput = document.getElementById('inventory-search-input');

        const profileAvatar = document.getElementById('profile-avatar');
        const editProfileAvatar = document.getElementById('edit-profile-avatar');
        const statusBadge = document.getElementById('status-badge');

        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const body = document.body;
        const sunIcon = document.querySelector('.sun-icon');
        const moonIcon = document.querySelector('.moon-icon');
        const logoLight = document.querySelector('.logo-light');
        const logoDark = document.querySelector('.logo-dark');

        // Variable global para almacenar datos del usuario seleccionado
        let currentProfileData = {};
        let currentEmployeeType = 'active'; // 'active', 'inactive' o 'inventory'

        // Función para cambiar entre pestañas de empleados (Activo/Inactivo/Inventario)
        function switchEmployeeTab(tabId, element) {
            // 1. Resetear todos los botones de pestaña
            document.querySelectorAll('#view-directory .tabs-container .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // 2. Activar el botón clickeado
            element.classList.add('active');

            // 3. Mostrar/ocultar grids correspondientes
            if (tabId === 'active') {
                activeEmployeesGrid.style.display = 'grid';
                inactiveEmployeesGrid.style.display = 'none';
                inventorySection.style.display = 'none';
                searchInput.style.display = 'block';
                searchInput.placeholder = 'Buscar por nombre o puesto...';
                currentEmployeeType = 'active';
            } else if (tabId === 'inactive') {
                activeEmployeesGrid.style.display = 'none';
                inactiveEmployeesGrid.style.display = 'grid';
                inventorySection.style.display = 'none';
                searchInput.style.display = 'block';
                searchInput.placeholder = 'Buscar por nombre o puesto...';
                currentEmployeeType = 'inactive';
            } else if (tabId === 'inventory') {
                activeEmployeesGrid.style.display = 'none';
                inactiveEmployeesGrid.style.display = 'none';
                inventorySection.style.display = 'block';
                searchInput.style.display = 'none';
                currentEmployeeType = 'inventory';
            }

            // 4. Limpiar búsqueda
            searchInput.value = '';
            if (inventorySearchInput) inventorySearchInput.value = '';
        }

        // Función para expandir/colapsar categorías de inventario
        function toggleCategory(categoryId) {
            const grid = document.getElementById(categoryId + '-grid');
            const icon = document.getElementById(categoryId + '-icon');
            
            if (grid.style.display === 'none' || grid.style.display === '') {
                grid.style.display = 'grid';
                icon.textContent = 'expand_less';
            } else {
                grid.style.display = 'none';
                icon.textContent = 'expand_more';
            }
        }

        // Función para búsqueda en tiempo real (empleados)
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const currentGrid = currentEmployeeType === 'active' ? activeEmployeesGrid : inactiveEmployeesGrid;
            const cards = currentGrid.querySelectorAll('.user-card');

            cards.forEach(card => {
                const name = card.querySelector('.name').textContent.toLowerCase();
                const role = card.querySelector('.role').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || role.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Función para búsqueda en inventario
        if (inventorySearchInput) {
            inventorySearchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const allCards = inventorySection.querySelectorAll('.user-card');

                allCards.forEach(card => {
                    const title = card.querySelector('h4').textContent.toLowerCase();
                    const id = card.querySelector('p').textContent.toLowerCase();
                    const user = card.querySelectorAll('div > span')[1] ? card.querySelectorAll('div > span')[1].textContent.toLowerCase() : '';
                    
                    if (title.includes(searchTerm) || id.includes(searchTerm) || user.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }

        // Función para mostrar la vista de perfil
        function showProfileView(name, role, imgId, status) {
            // 1. Guardar la data del usuario seleccionado
            currentProfileData = {
                name,
                role,
                imgId,
                status,
                fullName: 'Ana Sofía García Pérez',
                cedula: 'V-12.345.678'
            };

            // 2. Actualizar datos del perfil
            document.getElementById('profile-name').innerText = name;
            document.getElementById('profile-name-short').innerText = name;
            document.getElementById('profile-role').innerText = role;
            profileAvatar.style.backgroundImage = `url('https://i.pravatar.cc/150?img=${imgId}')`;
            
            // 3. Actualizar el badge de estado según el tipo de empleado
            if (status === 'active') {
                statusBadge.textContent = 'Activo';
                statusBadge.className = 'status-badge active';
            } else {
                statusBadge.textContent = 'Inactivo';
                statusBadge.className = 'status-badge inactive';
            }
            
            // 4. Cambiar vista: Ocultar directorio/edición y mostrar perfil detallado
            dirView.classList.remove('active');
            editProfileView.classList.remove('active');
            profileView.classList.add('active');

            // 5. Resetear a la primera pestaña (Hardware) al cargar el perfil
            const firstTab = document.querySelector('#view-profile .tabs-container .tab-btn:first-child');
            if (firstTab) {
                switchTab('hardware', firstTab);
            }
        }

        // Función para mostrar la vista de edición de perfil
        function showEditProfileView() {
            // 1. Ocultar la vista de perfil detallado
            profileView.classList.remove('active');
            
            // 2. Mostrar la vista de edición
            editProfileView.classList.add('active');

            // 3. Actualizar datos de la cabecera de edición con los datos guardados
            document.getElementById('edit-profile-name-full').innerText = `Editar Perfil de ${currentProfileData.name}`;
            document.getElementById('edit-profile-name-short').innerText = currentProfileData.name;
            editProfileAvatar.style.backgroundImage = `url('https://i.pravatar.cc/150?img=${currentProfileData.imgId}')`;

            // 4. Asegurarse de que la pestaña de Historial esté activa por defecto
            const historyTabBtn = document.querySelector('#view-edit-profile .tabs-container .tab-btn:last-child');
            if (historyTabBtn) {
                switchEditTab('history', historyTabBtn);
            }
        }

        // Función para volver a la vista de perfil detallado desde la edición
        function showProfileViewFromEdit() {
            editProfileView.classList.remove('active');
            profileView.classList.add('active');
        }

        // Función para volver al directorio
        function showDirectoryView() {
            profileView.classList.remove('active');
            editProfileView.classList.remove('active');
            dirView.classList.add('active');
        }

        // Función para cambiar entre pestañas de información (Hardware/Software/Obs) en la VISTA DETALLADA
        function switchTab(tabId, element) {
            // 1. Resetear todos los botones de pestaña
            document.querySelectorAll('#view-profile .tabs-container .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // 2. Activar el botón clickeado
            element.classList.add('active');

            // 3. Ocultar todos los contenidos de pestaña
            document.querySelectorAll('#view-profile .tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 4. Mostrar el contenido de la pestaña seleccionada
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        // Función para cambiar entre pestañas en la VISTA DE EDICIÓN
        function switchEditTab(tabId, element) {
            // 1. Determinar en qué vista estamos
            const parentView = element.closest('#view-profile, #view-edit-profile');
            
            if (!parentView) {
                console.error('No se encontró la vista padre');
                return;
            }
            
            const isProfileView = parentView.id === 'view-profile';
            const isEditView = parentView.id === 'view-edit-profile';
            
            // 2. Resetear SOLO los botones de esta vista específica
            parentView.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 3. Activar el botón clickeado
            element.classList.add('active');
            
            // 4. Ocultar todos los contenidos de pestaña de esta vista
            parentView.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 5. Mostrar el contenido correcto según la vista
            let targetId;
            if (isProfileView) {
                targetId = 'tab-' + tabId;
            } else if (isEditView) {
                targetId = 'tab-edit-' + tabId;
            }
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
                targetContent.classList.add('active');
            } else {
                console.error('No se encontró el contenido:', targetId);
            }
        }

        // Lógica de Alternar Tema (Dark/Light)
        themeToggleBtn.addEventListener('click', () => {
            // Alterna la clase 'dark-mode' en el <body>
            body.classList.toggle('dark-mode');
            
            // Cambiar íconos (sol/luna) y logos
            if (body.classList.contains('dark-mode')) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                
                // Manejo de Logos
                if (logoLight && logoDark) {
                    logoLight.classList.add('hidden');
                    logoDark.classList.remove('hidden');
                }
            } else {
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
                
                // Manejo de Logos
                if (logoLight && logoDark) {
                    logoLight.classList.remove('hidden');
                    logoDark.classList.add('hidden');
                }
            }
        });

            // ========================================
            // VARIABLES GLOBALES PARA EL FORMULARIO
            // ========================================

            // Paso actual del formulario (comienza en 1)
            let currentStep = 1;
            // Total de pasos en el formulario
            const totalSteps = 4;

            // ========================================
            // FUNCIÓN PARA MOSTRAR EL FORMULARIO
            // ========================================

            function showAddEmployeeForm() {
                // Mostrar el modal
                document.getElementById('add-employee-modal').style.display = 'flex';
                // Resetear al primer paso
                currentStep = 1;
                updateStepDisplay();
                // Prevenir scroll del body cuando el modal está abierto
                document.body.style.overflow = 'hidden';
            }

            function closeAddEmployeeForm() {
                // Ocultar el modal
                document.getElementById('add-employee-modal').style.display = 'none';
                // Restaurar scroll del body
                document.body.style.overflow = 'auto';
                // Limpiar todos los campos del formulario (opcional)
                // resetFormFields();
            }

            // ========================================
            // FUNCIÓN PARA AVANZAR AL SIGUIENTE PASO
            // ========================================

            function nextStep() {
                // Verificar que no estemos en el último paso
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }

            // ========================================
            // FUNCIÓN PARA RETROCEDER AL PASO ANTERIOR
            // ========================================

            function previousStep() {
                // Verificar que no estemos en el primer paso
                if (currentStep > 1) {
                    currentStep--;
                    updateStepDisplay();
                }
            }

            // ========================================
            // FUNCIÓN PARA ACTUALIZAR LA VISUALIZACIÓN DE LOS PASOS
            // ========================================

            function updateStepDisplay() {
                // 1. ACTUALIZAR INDICADORES DE PASOS (STEPPER)
                
                const stepItems = document.querySelectorAll('.step-item');
                const stepConnectors = document.querySelectorAll('.step-connector');
                
                stepItems.forEach((item, index) => {
                    const stepNumber = index + 1;
                    
                    // Remover todas las clases primero
                    item.classList.remove('active', 'completed');
                    
                    if (stepNumber < currentStep) {
                        // Pasos anteriores = completados
                        item.classList.add('completed');
                    } else if (stepNumber === currentStep) {
                        // Paso actual = activo
                        item.classList.add('active');
                    }
                    // Los pasos futuros no tienen clase especial
                });
                
                // Actualizar conectores entre pasos
                stepConnectors.forEach((connector, index) => {
                    connector.classList.remove('completed');
                    if (index < currentStep - 1) {
                        connector.classList.add('completed');
                    }
                });
                
                // 2. MOSTRAR/OCULTAR CONTENIDO DE PASOS
                
                const formSteps = document.querySelectorAll('.form-step');
                formSteps.forEach((step, index) => {
                    step.classList.remove('active');
                    if (index === currentStep - 1) {
                        step.classList.add('active');
                    }
                });
                
                // 3. ACTUALIZAR BOTONES DE NAVEGACIÓN
                
                const prevBtn = document.getElementById('prev-step-btn');
                const nextBtn = document.getElementById('next-step-btn');
                const submitBtn = document.getElementById('submit-form-btn');
                
                // Mostrar botón "Anterior" solo si no estamos en el primer paso
                if (currentStep === 1) {
                    prevBtn.style.display = 'none';
                } else {
                    prevBtn.style.display = 'flex';
                }
                
                // Mostrar botón "Siguiente" hasta el penúltimo paso
                if (currentStep === totalSteps) {
                    nextBtn.style.display = 'none';
                    submitBtn.style.display = 'flex';
                } else {
                    nextBtn.style.display = 'flex';
                    submitBtn.style.display = 'none';
                }
            }

            // ========================================
            // FUNCIÓN PARA ENVIAR EL FORMULARIO COMPLETO
            // ========================================

            function submitEmployeeForm() {
                // Aquí puedes agregar la lógica para:
                // 1. Validar todos los campos
                // 2. Recopilar los datos del formulario
                // 3. Enviar los datos al servidor (API)
                // 4. Crear la tarjeta del nuevo empleado en la vista
                
                // Por ahora, solo mostramos una alerta de confirmación
                alert('¡Empleado registrado exitosamente!');
                
                // Cerrar el modal
                closeAddEmployeeForm();
                
                // Aquí podrías agregar el nuevo empleado al grid dinámicamente
                // addNewEmployeeCard(employeeData);
            }

            // ========================================
            // FUNCIÓN AUXILIAR PARA RESETEAR CAMPOS (OPCIONAL)
            // ========================================

            function resetFormFields() {
                // Resetear todos los inputs del formulario
                const modal = document.getElementById('add-employee-modal');
                const inputs = modal.querySelectorAll('input');
                inputs.forEach(input => {
                    input.value = '';
                });
                
                // Volver al primer paso
                currentStep = 1;
                updateStepDisplay();
            }

            // ========================================
            // CERRAR MODAL AL HACER CLIC FUERA DE ÉL
            // ========================================

            document.addEventListener('click', function(event) {
                const modal = document.getElementById('add-employee-modal');
                if (modal && event.target === modal) {
                    closeAddEmployeeForm();
                }
            });

            // ========================================
            // CERRAR MODAL CON TECLA ESC
            // ========================================

            document.addEventListener('keydown', function(event) {
                const modal = document.getElementById('add-employee-modal');
                if (modal && modal.style.display === 'flex' && event.key === 'Escape') {
                    closeAddEmployeeForm();
                }
            });

            // ========================================
            // MODIFICACIÓN DE LA FUNCIÓN switchEmployeeTab
            // Para mostrar/ocultar el botón "Agregar Empleado"
            // ========================================

            // REEMPLAZAR la función switchEmployeeTab existente con esta versión mejorada:

            function switchEmployeeTab(tabId, element) {
                // 1. Resetear todos los botones de pestaña
                document.querySelectorAll('#view-directory .tabs-container .tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                // 2. Activar el botón clickeado
                element.classList.add('active');

                // 3. Referencias al botón de agregar empleado
                const addEmployeeBtnContainer = document.getElementById('add-employee-btn-container');

                // 4. Mostrar/ocultar grids correspondientes
                if (tabId === 'active') {
                    activeEmployeesGrid.style.display = 'grid';
                    inactiveEmployeesGrid.style.display = 'none';
                    inventorySection.style.display = 'none';
                    searchInput.style.display = 'block';
                    searchInput.placeholder = 'Buscar por nombre o puesto...';
                    
                    // MOSTRAR botón "Agregar Empleado" solo en pestaña Activos
                    if (addEmployeeBtnContainer) {
                        addEmployeeBtnContainer.style.display = 'flex';
                    }
                    
                    currentEmployeeType = 'active';
                } else if (tabId === 'inactive') {
                    activeEmployeesGrid.style.display = 'none';
                    inactiveEmployeesGrid.style.display = 'grid';
                    inventorySection.style.display = 'none';
                    searchInput.style.display = 'block';
                    searchInput.placeholder = 'Buscar por nombre o puesto...';
                    
                    // OCULTAR botón "Agregar Empleado" en otras pestañas
                    if (addEmployeeBtnContainer) {
                        addEmployeeBtnContainer.style.display = 'none';
                    }
                    
                    currentEmployeeType = 'inactive';
                } else if (tabId === 'inventory') {
                    activeEmployeesGrid.style.display = 'none';
                    inactiveEmployeesGrid.style.display = 'none';
                    inventorySection.style.display = 'block';
                    searchInput.style.display = 'none';
                    
                    // OCULTAR botón "Agregar Empleado" en otras pestañas
                    if (addEmployeeBtnContainer) {
                        addEmployeeBtnContainer.style.display = 'none';
                    }
                    
                    currentEmployeeType = 'inventory';
                }

                // 5. Limpiar búsqueda
                searchInput.value = '';
                if (inventorySearchInput) inventorySearchInput.value = '';
            }

            // ============================================
            // FUNCIONALIDAD DEL MODAL DE AÑADIR DISPOSITIVO
            // Agregar estas funciones ANTES del cierre de 
            // ============================================

            /**
            * Abre el modal de añadir dispositivo
            * Se llama cuando se presiona el botón "Añadir Dispositivo" en la vista de inventario
            */
            function openAddDeviceModal() {
                const modal = document.getElementById('add-device-modal');
                
                // Mostrar el modal con flex para centrado
                modal.style.display = 'flex';
                
                // Resetear a la primera pestaña (Individual)
                const firstTab = document.querySelector('.device-tab-btn:first-child');
                if (firstTab) {
                    switchDeviceTab('individual', firstTab);
                }
                
                // Prevenir scroll del body cuando el modal está abierto
                document.body.style.overflow = 'hidden';
                
                // Limpiar campos del formulario
                resetDeviceFormFields();
            }

            /**
            * Cierra el modal de añadir dispositivo
            * Restaura el scroll del body
            */
            function closeAddDeviceModal() {
                const modal = document.getElementById('add-device-modal');
                
                // Ocultar el modal
                modal.style.display = 'none';
                
                // Restaurar scroll del body
                document.body.style.overflow = 'auto';
            }

            /**
            * Cambia entre las pestañas del modal (Individual / Múltiples)
            * @param {string} tabId - ID de la pestaña ('individual' o 'multiple')
            * @param {HTMLElement} element - Elemento del botón clickeado
            */
            function switchDeviceTab(tabId, element) {
                // 1. Resetear todos los botones de pestaña
                document.querySelectorAll('.device-tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // 2. Activar el botón clickeado
                element.classList.add('active');
                
                // 3. Ocultar todo el contenido de las pestañas
                document.querySelectorAll('.device-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 4. Mostrar el contenido de la pestaña seleccionada
                document.getElementById('device-tab-' + tabId).classList.add('active');
            }

            /**
            * Resetea todos los campos del formulario de dispositivos
            * Útil al abrir el modal o después de guardar
            */
            function resetDeviceFormFields() {
                const modal = document.getElementById('add-device-modal');
                
                // Resetear todos los inputs y selects
                const inputs = modal.querySelectorAll('input:not([type="checkbox"]), select');
                inputs.forEach(input => {
                    if (input.tagName === 'SELECT') {
                        input.selectedIndex = 0;
                    } else {
                        input.value = '';
                    }
                });
                
                // Resetear cantidad a 1 en pestaña múltiple
                const quantityInput = modal.querySelector('#device-tab-multiple input[type="number"]');
                if (quantityInput) {
                    quantityInput.value = '1';
                }
                
                // Marcar checkbox de auto-incrementar
                const autoIncrementCheckbox = modal.querySelector('#device-tab-multiple input[type="checkbox"]');
                if (autoIncrementCheckbox) {
                    autoIncrementCheckbox.checked = true;
                }
            }

            /**
            * Procesa el formulario de dispositivo individual
            * AQUÍ DEBES AGREGAR LA LÓGICA PARA GUARDAR EN TU BASE DE DATOS
            */
            function submitIndividualDevice() {
                // Obtener valores del formulario
                const modal = document.getElementById('device-tab-individual');
                const inputs = modal.querySelectorAll('input, select');
                
                // Crear objeto con los datos del dispositivo
                const deviceData = {
                    name: inputs[0].value,
                    id: inputs[1].value,
                    serialNumber: inputs[2].value,
                    type: inputs[3].value,
                    status: inputs[4].value,
                    assignedUser: inputs[5].value
                };
                
                // Validación básica
                if (!deviceData.name || !deviceData.id || !deviceData.type) {
                    alert('Por favor completa los campos obligatorios: Nombre, ID y Tipo de Dispositivo');
                    return;
                }
                
                // AQUÍ AGREGAR LÓGICA PARA GUARDAR EN BASE DE DATOS
                console.log('Dispositivo individual a guardar:', deviceData);
                
                // Mostrar mensaje de éxito
                alert('¡Dispositivo añadido exitosamente!');
                
                // Cerrar modal
                closeAddDeviceModal();
                
                // AQUÍ PUEDES AGREGAR LÓGICA PARA ACTUALIZAR LA VISTA
                // Por ejemplo: addDeviceCardToUI(deviceData);
            }

            /**
            * Procesa el formulario de múltiples dispositivos
            * AQUÍ DEBES AGREGAR LA LÓGICA PARA GUARDAR MÚLTIPLES DISPOSITIVOS
            */
            function submitMultipleDevices() {
                // Obtener valores del formulario
                const modal = document.getElementById('device-tab-multiple');
                const inputs = modal.querySelectorAll('input, select');
                
                // Crear objeto con los datos
                const deviceData = {
                    type: inputs[0].value,
                    quantity: parseInt(inputs[1].value),
                    initialSerial: inputs[2].value,
                    autoIncrement: inputs[3].checked,
                    status: inputs[4].value
                };
                
                // Validación básica
                if (!deviceData.type || deviceData.quantity < 1) {
                    alert('Por favor completa los campos obligatorios: Tipo y Cantidad');
                    return;
                }
                
                // AQUÍ AGREGAR LÓGICA PARA GENERAR Y GUARDAR MÚLTIPLES DISPOSITIVOS
                console.log('Dispositivos múltiples a guardar:', deviceData);
                
                // Mostrar mensaje de éxito
                alert(`¡${deviceData.quantity} dispositivo(s) añadido(s) exitosamente!`);
                
                // Cerrar modal
                closeAddDeviceModal();
                
                // AQUÍ PUEDES AGREGAR LÓGICA PARA ACTUALIZAR LA VISTA
            }

            // ============================================
            // EVENT LISTENERS PARA EL MODAL DE DISPOSITIVOS
            // ============================================

            // Cerrar modal al hacer clic fuera de él
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('add-device-modal');
                if (modal && event.target === modal) {
                    closeAddDeviceModal();
                }
            });

            // Cerrar modal con tecla ESC
            document.addEventListener('keydown', function(event) {
                const modal = document.getElementById('add-device-modal');
                if (modal && modal.style.display === 'flex' && event.key === 'Escape') {
                    closeAddDeviceModal();
                }
            });

            // ============================================
            // FUNCIONALIDAD DEL MODAL DE EDICIÓN DE DISPOSITIVO
            // ============================================

            /**
             * Variable global para almacenar la información del dispositivo que se está editando
             * Guarda la referencia a la tarjeta HTML para poder actualizarla después
             */
            let currentEditingDevice = {
                cardElement: null,  // Elemento HTML de la tarjeta
                data: {}            // Datos del dispositivo
            };

            /**
             * Extrae el tipo de dispositivo desde el nombre
             * Ej: "Monitor Dell U2721DE" → "Monitor"
             * @param {string} name - Nombre completo del dispositivo
             * @returns {string} - Tipo de dispositivo
             */
            function extractDeviceType(name) {
                const types = ['Monitor', 'Teclado', 'Mouse', 'CPU', 'Diadema', 'Antena'];
                for (let type of types) {
                    if (name.includes(type)) {
                        return type;
                    }
                }
                return 'Dispositivo';
            }

            /**
             * Extrae la marca desde el nombre del dispositivo
             * Ej: "Monitor Dell U2721DE" → "Dell"
             * @param {string} name - Nombre completo del dispositivo
             * @returns {string} - Marca del dispositivo
             */
            function extractDeviceBrand(name) {
                const brands = ['Dell', 'LG', 'Logitech', 'HP', 'Sony', 'Bose', 'TP-Link', 'Keychron', 'Redragon'];
                for (let brand of brands) {
                    if (name.includes(brand)) {
                        return brand;
                    }
                }
                return 'No especificada';
            }

            /**
             * Abre el modal de edición y carga la información del dispositivo seleccionado
             * Esta función se llama cuando el usuario hace clic en el botón del lápiz
             * @param {HTMLElement} button - Elemento del botón que disparó el evento
             */
            function openEditDeviceModal(button) {
                // 1. Obtener la tarjeta padre del botón clickeado
                const card = button.closest('.user-card');
                
                if (!card) {
                    console.error('No se encontró la tarjeta del dispositivo');
                    return;
                }
                
                // 2. Extraer información de la tarjeta
                const deviceName = card.querySelector('h4').textContent;
                const deviceId = card.querySelector('p').textContent.replace('ID: ', '');
                
                // Buscar usuario asignado y estado
                const userSpan = card.querySelectorAll('div > span')[1];
                const statusSpan = card.querySelector('.info-value span') || card.querySelector('[style*="background"]');
                
                const assignedUser = userSpan ? userSpan.textContent : 'N/A';
                const statusText = statusSpan ? statusSpan.textContent.trim() : 'En Almacén';
                
                // 3. Guardar referencia al dispositivo actual
                currentEditingDevice = {
                    cardElement: card,
                    data: {
                        name: deviceName,
                        id: deviceId,
                        serialNumber: 'SN-' + Math.random().toString(36).substr(2, 9).toUpperCase(), // Simulado
                        type: extractDeviceType(deviceName),
                        brand: extractDeviceBrand(deviceName),
                        assignedUser: assignedUser,
                        status: statusText
                    }
                };
                
                // 4. Llenar el formulario con los datos
                document.getElementById('edit-device-name').value = currentEditingDevice.data.name;
                document.getElementById('edit-device-id').value = currentEditingDevice.data.id;
                document.getElementById('edit-device-serial').value = currentEditingDevice.data.serialNumber;
                document.getElementById('edit-device-type').value = currentEditingDevice.data.type;
                document.getElementById('edit-device-brand').value = currentEditingDevice.data.brand;
                document.getElementById('edit-device-user').value = currentEditingDevice.data.assignedUser === 'N/A' ? '' : currentEditingDevice.data.assignedUser;
                
                // 5. Seleccionar el estado correcto en el dropdown
                const statusSelect = document.getElementById('edit-device-status');
                const statusMap = {
                    'Asignado': 'assigned',
                    'En Almacén': 'storage',
                    'En Mantenimiento': 'maintenance',
                    'Dañado': 'damaged'
                };
                statusSelect.value = statusMap[statusText] || 'storage';
                
                // 6. Mostrar el modal
                const modal = document.getElementById('edit-device-modal');
                modal.style.display = 'flex';
                
                // 7. Prevenir scroll del body
                document.body.style.overflow = 'hidden';
            }

            /**
             * Cierra el modal de edición y restaura el scroll
             */
            function closeEditDeviceModal() {
                const modal = document.getElementById('edit-device-modal');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Limpiar referencia al dispositivo actual
                currentEditingDevice = { cardElement: null, data: {} };
            }

            /**
             * Guarda los cambios realizados en el modal y actualiza la tarjeta correspondiente
             * Solo actualiza visualmente, no hace peticiones al backend
             */
            function saveDeviceChanges() {
                // 1. Obtener nuevos valores editables
                const newStatus = document.getElementById('edit-device-status').value;
                const newUser = document.getElementById('edit-device-user').value.trim() || 'N/A';
                
                // 2. Mapeo de estados para mostrar en español
                const statusTextMap = {
                    'assigned': 'Asignado',
                    'storage': 'En Almacén',
                    'maintenance': 'En Mantenimiento',
                    'damaged': 'Dañado'
                };
                
                const statusStyleMap = {
                    'assigned': { bg: '#d4edda', color: '#155724' },
                    'storage': { bg: '#fff3cd', color: '#856404' },
                    'maintenance': { bg: '#d1ecf1', color: '#0c5460' },
                    'damaged': { bg: '#f8d7da', color: '#721c24' }
                };
                
                // 3. Actualizar la tarjeta del dispositivo
                const card = currentEditingDevice.cardElement;
                
                if (!card) {
                    alert('Error: No se pudo actualizar el dispositivo');
                    return;
                }
                
                // Actualizar usuario asignado
                const userSpan = card.querySelectorAll('div > span')[1];
                if (userSpan) {
                    userSpan.textContent = newUser;
                }
                
                // Actualizar estado (badge)
                const statusSpan = card.querySelector('[style*="background"]');
                if (statusSpan) {
                    const style = statusStyleMap[newStatus];
                    statusSpan.textContent = statusTextMap[newStatus];
                    statusSpan.style.background = style.bg;
                    statusSpan.style.color = style.color;
                }
                
                // 4. Mostrar mensaje de éxito
                alert('✅ Dispositivo actualizado exitosamente');
                
                // 5. Cerrar el modal
                closeEditDeviceModal();
                
                // 6. AQUÍ PUEDES AGREGAR LÓGICA PARA ENVIAR AL BACKEND
                // Ejemplo:
                // fetch('/api/devices/update', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({
                //         deviceId: currentEditingDevice.data.id,
                //         status: newStatus,
                //         assignedUser: newUser
                //     })
                // });
            }

            /**
             * Agrega event listeners a todos los botones de editar (lápiz)
             * Se ejecuta cuando la página carga
             */
            function initializeEditButtons() {
                // Seleccionar todos los botones de editar (ícono de lápiz)
                const editButtons = document.querySelectorAll('#inventory-section button[style*="edit"]');
                
                editButtons.forEach(button => {
                    // Verificar que el botón contiene el ícono "edit"
                    const icon = button.querySelector('.material-symbols-outlined');
                    if (icon && icon.textContent.trim() === 'edit') {
                        button.addEventListener('click', function() {
                            openEditDeviceModal(this);
                        });
                    }
                });
            }

            // ============================================
            // EVENT LISTENERS PARA EL MODAL DE EDICIÓN
            // ============================================

            // Cerrar modal al hacer clic en el overlay (fondo oscuro)
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('edit-device-modal');
                if (modal && event.target === modal) {
                    closeEditDeviceModal();
                }
            });

            // Cerrar modal con tecla ESC
            document.addEventListener('keydown', function(event) {
                const modal = document.getElementById('edit-device-modal');
                if (modal && modal.style.display === 'flex' && event.key === 'Escape') {
                    closeEditDeviceModal();
                }
            });

            // Inicializar los botones de edición cuando la página carga
            document.addEventListener('DOMContentLoaded', function() {
                initializeEditButtons();
            });
            
            // ============================================
            // INICIALIZACIÓN DE EMERGENCIA
            // ============================================

            // Ejecutar cuando TODO esté cargado
            window.addEventListener('load', function() {
                console.log('🔍 Iniciando búsqueda de botones de edición...');
                
                // Buscar TODOS los botones en el documento
                const allButtons = document.querySelectorAll('button');
                let editButtonsFound = 0;
                
                allButtons.forEach(button => {
                    const icon = button.querySelector('.material-symbols-outlined');
                    
                    if (icon && icon.textContent.trim() === 'edit') {
                        // Remover listeners previos
                        const newButton = button.cloneNode(true);
                        button.parentNode.replaceChild(newButton, button);
                        
                        // Agregar nuevo listener
                        newButton.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('✅ Botón de editar clickeado');
                            openEditDeviceModal(this);
                        });
                        
                        editButtonsFound++;
                    }
                });
                
                console.log(`✅ Se encontraron y configuraron ${editButtonsFound} botones de edición`);
            });

            // ============================================
            // FUNCIONES PARA MODAL DE CREAR SOFTWARE
            // ============================================

            function openCreateSoftwareModal() {
                console.log('🔵 Intentando abrir modal de software...');
                
                const modal = document.getElementById('create-software-modal');
                
                if (!modal) {
                    console.error('❌ ERROR: Modal de software no encontrado');
                    alert('Error: No se pudo encontrar el modal de software');
                    return;
                }
                
                console.log('✅ Modal encontrado');
                
                // Forzar estilos directamente
                modal.style.display = 'flex';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.zIndex = '9999';
                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                
                // Bloquear scroll
                document.body.style.overflow = 'hidden';
                
                // Resetear formulario
                resetSoftwareForm();
                
                console.log('✅ Modal de software abierto exitosamente');
            }

            function closeCreateSoftwareModal() {
                const modal = document.getElementById('create-software-modal');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            function resetSoftwareForm() {
                document.getElementById('software-name').value = '';
                document.getElementById('software-version').value = '';
                document.getElementById('software-description').value = '';
                document.getElementById('software-category').selectedIndex = 0;
                document.getElementById('software-area').selectedIndex = 0;
                document.getElementById('software-plan').selectedIndex = 0;
                document.getElementById('software-cost').value = '';
                
                // Limpiar credenciales
                document.getElementById('software-email').value = '';
                document.getElementById('software-password').value = '';
                document.getElementById('software-google-email').value = '';
                
                // Resetear tipo de autenticación
                document.getElementById('auth-credentials').checked = true;
                toggleAuthFields('credentials');
                
                // Desmarcar radio buttons de licencia
                document.querySelectorAll('input[name="license-type"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // ✨ Desmarcar radio buttons de período de facturación
                document.querySelectorAll('input[name="billing-period"]').forEach(radio => {
                    radio.checked = false;
                });
            }

            // NUEVA FUNCIÓN: Alternar entre campos de credenciales y Google
            function toggleAuthFields(type) {
                const credentialsFields = document.getElementById('credentials-fields');
                const googleFields = document.getElementById('google-fields');
                
                if (type === 'credentials') {
                    credentialsFields.style.display = 'block';
                    googleFields.style.display = 'none';
                    
                    // Limpiar campos de Google
                    document.getElementById('software-google-email').value = '';
                } else if (type === 'google') {
                    credentialsFields.style.display = 'none';
                    googleFields.style.display = 'block';
                    
                    // Limpiar campos de credenciales
                    document.getElementById('software-email').value = '';
                    document.getElementById('software-password').value = '';
                }
            }

            function saveSoftware() {
                    // Obtener valores del formulario
                const softwareData = {
                    name: document.getElementById('software-name').value,
                    version: document.getElementById('software-version').value,
                    description: document.getElementById('software-description').value,
                    category: document.getElementById('software-category').value,
                    area: document.getElementById('software-area').value,
                    licenseType: document.querySelector('input[name="license-type"]:checked')?.value || '',
                    plan: document.getElementById('software-plan').value,
                    cost: document.getElementById('software-cost').value,
                    billingPeriod: document.querySelector('input[name="billing-period"]:checked')?.value || '', // ✨ NUEVO
                    // Credenciales
                    email: document.getElementById('software-email')?.value || '',
                    password: document.getElementById('software-password')?.value || '',
                    authType: document.querySelector('input[name="auth-type"]:checked')?.value || 'credentials',
                    googleEmail: document.getElementById('software-google-email')?.value || ''
                };
                
                // Validación básica
                if (!softwareData.name || !softwareData.category) {
                    alert('⚠️ Por favor completa al menos el nombre y la categoría del software');
                    return;
                }
                
                // Validación de credenciales según tipo de autenticación
                if (softwareData.authType === 'credentials') {
                    if (!softwareData.email || !softwareData.password) {
                        alert('⚠️ Por favor completa el correo y contraseña');
                        return;
                    }
                } else if (softwareData.authType === 'google') {
                    if (!softwareData.googleEmail) {
                        alert('⚠️ Por favor especifica el correo de Google asociado');
                        return;
                    }
                }
                
                // AQUÍ PUEDES AGREGAR LÓGICA PARA GUARDAR EN BASE DE DATOS
                console.log('Software a guardar:', softwareData);
                
                // Agregar al select de software existente en el formulario de empleado
                const select = document.getElementById('existing-software-select');
                const optionText = `${softwareData.name} ${softwareData.version ? '- ' + softwareData.version : ''}`;
                const option = new Option(optionText, softwareData.name.toLowerCase().replace(/\s/g, '_'));
                select.add(option);
                
                // ✅ CERRAR MODAL AUTOMÁTICAMENTE
                closeCreateSoftwareModal();
                
                // Mostrar mensaje de éxito
                alert('✅ Software creado y agregado exitosamente');
            }

            // Cerrar modal al hacer clic fuera
            document.addEventListener('click', function(event) {
                const modal = document.getElementById('create-software-modal');
                if (modal && event.target === modal) {
                    closeCreateSoftwareModal();
                }
            });

            // ============================================
            // FUNCIONES PARA AGREGAR HARDWARE
            // ============================================

             function openAddHardwareModal() {
                openCatalogModal();
                const originalOpenAddHardwareModal = typeof openAddHardwareModal !== 'undefined' ? openAddHardwareModal : null;

            }


            function addHardwareToTable(device, model, serial) {
                const table = document.getElementById('assigned-hardware-table').querySelector('tbody');
                const noDataRow = document.getElementById('no-hardware-row');
                
                // Ocultar mensaje "sin hardware"
                if (noDataRow) {
                    noDataRow.style.display = 'none';
                }
                
                // Crear nueva fila
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${device}</td>
                    <td>${model}</td>
                    <td>${serial}</td>
                    <td>
                        <button 
                            onclick="removeHardwareRow(this)" 
                            style="padding: 0.25rem 0.5rem; background: transparent; border: none; cursor: pointer; color: var(--error-color);"
                            type="button"
                        >
                            <span class="material-symbols-outlined" style="font-size: 1.25rem;">delete</span>
                        </button>
                    </td>
                `;
            }

            function removeHardwareRow(button) {
                const row = button.closest('tr');
                row.remove();
                
                // Mostrar mensaje si no hay filas
                const table = document.getElementById('assigned-hardware-table').querySelector('tbody');
                if (table.rows.length === 1) { // Solo queda la fila "no hay hardware"
                    document.getElementById('no-hardware-row').style.display = 'table-row';
                }
            }

            // ============================================
            // EVENT LISTENER PARA BOTÓN DE SOFTWARE (FORZADO)
            // ============================================
            
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🔵 Inicializando botón de software...');
                
                const btnSoftware = document.getElementById('btn-open-software-modal');
                
                if (btnSoftware) {
                    console.log('✅ Botón de software encontrado');
                    
                    // Remover onclick si existe
                    btnSoftware.removeAttribute('onclick');
                    
                    // Agregar listener limpio
                    btnSoftware.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('🔘 Click en botón de software detectado');
                        openCreateSoftwareModal();
                    });
                } else {
                    console.error('❌ No se encontró el botón de software');
                }
            });

            // ============================================
            // SISTEMA DE HISTORIAL DE CAMBIOS
            // ============================================

            // Array global para almacenar el historial
            let employeeHistory = [
                {
                    fecha: '15/05/2024',
                    componente: 'RAM',
                    valorAnterior: '8 GB',
                    valorNuevo: '16 GB',
                    realizadoPor: 'Admin TI',
                    timestamp: new Date('2024-05-15T10:30:00')
                },
                {
                    fecha: '10/01/2024',
                    componente: 'Mouse',
                    valorAnterior: 'Apple Magic Mouse',
                    valorNuevo: 'Logitech MX Master 3S',
                    realizadoPor: 'Admin TI',
                    timestamp: new Date('2024-01-10T14:20:00')
                },
                {
                    fecha: '10/01/2024',
                    componente: 'Diadema',
                    valorAnterior: 'N/A',
                    valorNuevo: 'Sony WH-1000XM5',
                    realizadoPor: 'Admin TI',
                    timestamp: new Date('2024-01-10T14:25:00')
                }
            ];

            // Función para registrar un cambio en el historial
            function registerChange(componente, valorAnterior, valorNuevo, realizadoPor = 'Admin TI') {
                // Solo registrar si hay cambio real
                if (valorAnterior === valorNuevo) return;
                
                const change = {
                    fecha: new Date().toLocaleDateString('es-ES'),
                    componente: componente,
                    valorAnterior: valorAnterior || 'N/A',
                    valorNuevo: valorNuevo,
                    realizadoPor: realizadoPor,
                    timestamp: new Date()
                };
                
                employeeHistory.unshift(change); // Agregar al inicio
                updateHistoryTable();
                
                // Guardar en localStorage
                localStorage.setItem('employeeHistory_' + currentProfileData.name, JSON.stringify(employeeHistory));
                
                console.log('✅ Cambio registrado:', change);
            }

            // Función para actualizar la tabla de historial
            function updateHistoryTable() {
                const tbody = document.querySelector('#history-table tbody');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                // Ordenar por fecha más reciente
                const sortedHistory = [...employeeHistory].sort((a, b) => b.timestamp - a.timestamp);
                
                if (sortedHistory.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                No hay cambios registrados aún
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                sortedHistory.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.fecha}</td>
                        <td>${item.componente}</td>
                        <td>${item.valorAnterior}</td>
                        <td>${item.valorNuevo}</td>
                        <td>${item.realizadoPor}</td>
                    `;
                });
            }

            // Exportar historial a Excel (CSV)
            function exportHistoryToExcel() {
                if (employeeHistory.length === 0) {
                    alert('⚠️ No hay datos para exportar');
                    return;
                }

                const headers = ['FECHA', 'COMPONENTE', 'VALOR ANTERIOR', 'VALOR NUEVO', 'REALIZADO POR'];
                const csvData = [headers];
                
                // Ordenar por fecha más reciente
                const sortedHistory = [...employeeHistory].sort((a, b) => b.timestamp - a.timestamp);
                
                sortedHistory.forEach(item => {
                    const rowData = [
                        item.fecha,
                        item.componente,
                        item.valorAnterior,
                        item.valorNuevo,
                        item.realizadoPor
                    ];
                    csvData.push(rowData);
                });
                
                // Convertir a CSV
                const csvContent = csvData.map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');
                
                // Crear archivo y descargar
                const blob = new Blob(['\ufeff' + csvContent], { 
                    type: 'text/csv;charset=utf-8;' 
                });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const employeeName = currentProfileData.name || 'empleado';
                link.download = `historial_${employeeName.replace(/\s/g, '_')}_${new Date().getTime()}.csv`;
                link.click();
                
                alert('✅ Archivo Excel descargado exitosamente');
            }

            // ============================================
            // INTEGRACIÓN CON GUARDAR CAMBIOS
            // ============================================

            // Cargar historial desde localStorage al mostrar el perfil
            function loadEmployeeHistory() {
                if (!currentProfileData.name) return;
                
                const savedHistory = localStorage.getItem('employeeHistory_' + currentProfileData.name);
                if (savedHistory) {
                    employeeHistory = JSON.parse(savedHistory);
                    // Convertir timestamps de string a Date
                    employeeHistory.forEach(item => {
                        item.timestamp = new Date(item.timestamp);
                    });
                }
                updateHistoryTable();
            }

            // Modificar showProfileView para cargar el historial
            const originalShowProfileView = showProfileView;
            showProfileView = function(name, role, imgId, status) {
                originalShowProfileView(name, role, imgId, status);
                loadEmployeeHistory();
            };

            // Modificar showEditProfileView para cargar el historial
            const originalShowEditProfileView = showEditProfileView;
            showEditProfileView = function() {
                originalShowEditProfileView();
                loadEmployeeHistory();
            };

            // ============================================
            // CAPTURAR CAMBIOS EN FORMULARIOS
            // ============================================

            // Función para capturar cambios cuando se guarda el formulario de edición
            // REEMPLAZAR la función captureFormChanges completa:
            function captureFormChanges() {
                // ========================================
                // INFORMACIÓN PERSONAL
                // ========================================
                const camposPersonales = [
                    { id: 'edit-nombre-completo', nombre: 'Nombre Completo', original: 'Ana SofÃ­a GarcÃ­a PÃ©rez' },
                    { id: 'edit-fecha-nacimiento', nombre: 'Fecha de Nacimiento', original: '10/05/1985' },
                    { id: 'edit-cedula', nombre: 'Cédula', original: 'V-12.345.678' },
                    { id: 'edit-celular', nombre: 'Celular', original: '+58 412-1234567' },
                    { id: 'edit-correo', nombre: 'Correo', original: 'ana.garcia.p@email.com' },
                    { id: 'edit-direccion', nombre: 'Dirección', original: 'Calle Falsa 123, Apto 4B' },
                    { id: 'edit-localidad', nombre: 'Localidad', original: 'Bosa, La Independencia' },
                    { id: 'edit-ciudad', nombre: 'Ciudad', original: 'BogotÃ¡ D.C.' },
                    { id: 'edit-tipo-sangre', nombre: 'Tipo de Sangre', original: 'O+' },
                    { id: 'edit-num-hijos', nombre: 'Número de Hijos', original: '2' },
                    { id: 'edit-contacto-emergencia', nombre: 'Contacto Emergencia', original: 'Carlos PÃ©rez' },
                    { id: 'edit-telefono-emergencia', nombre: 'Teléfono Emergencia', original: '+57 310-9876543' },
                    { id: 'edit-parentesco-emergencia', nombre: 'Parentesco Emergencia', original: 'Padre' }
                ];
                
                // ========================================
                // INFORMACIÓN LABORAL
                // ========================================
                const camposLaborales = [
                    { id: 'edit-cargo', nombre: 'Cargo', original: 'Desarrollador Senior' },
                    { id: 'edit-area-departamento', nombre: 'Ãrea/Departamento', original: 'TecnologÃ­a de la InformaciÃ³n' },
                    { id: 'edit-jefe-inmediato', nombre: 'Jefe Inmediato', original: 'Carlos RodrÃ­guez' },
                    { id: 'edit-correo-corporativo', nombre: 'Correo Corporativo', original: 'correo@empresa.com' },
                    { id: 'edit-inicio-contrato', nombre: 'Inicio de Contrato', original: '2020-01-15' },
                    { id: 'edit-id-biometrico', nombre: 'ID Biométrico', original: 'BIO-2023-001234' }
                ];
                
                // ========================================
                // HARDWARE
                // ========================================
                const camposHardware = [
                    { id: 'edit-procesador', nombre: 'Procesador', original: 'Intel Core i7 12th Gen' },
                    { id: 'edit-ram', nombre: 'RAM', original: '16 GB DDR4' },
                    { id: 'edit-almacenamiento', nombre: 'Almacenamiento', original: '512 GB SSD NVMe' },
                    { id: 'edit-gpu', nombre: 'Tarjeta GrÃ¡fica', original: 'NVIDIA RTX 3050' },
                    { id: 'edit-antena-wifi', nombre: 'Antena Wifi', original: 'Integrada' },
                    { id: 'edit-mouse', nombre: 'Mouse', original: 'Logitech G203' },
                    { id: 'edit-teclado', nombre: 'Teclado', original: 'MecÃ¡nico Redragon' },
                    { id: 'edit-diadema', nombre: 'Diadema', original: 'Sony WH-1000XM5' }
                ];
                
                // ========================================
                // SOFTWARE
                // ========================================
                const camposSoftware = [
                    { id: 'edit-office365', nombre: 'Microsoft Office 365', original: 'Licencia E3' },
                    { id: 'edit-adobe', nombre: 'Adobe Creative Cloud', original: 'Todas las aplicaciones' },
                    { id: 'edit-slack', nombre: 'Slack', original: 'Plan Pro' },
                    { id: 'edit-figma', nombre: 'Figma', original: 'Licencia Profesional' },
                    { id: 'edit-jira', nombre: 'Jira', original: 'Acceso Completo' },
                    { id: 'edit-gitlab', nombre: 'GitLab', original: 'Rol de Mantenedor' }
                ];
                
                // ========================================
                // PROCESAR TODOS LOS CAMPOS
                // ========================================
                const todosCampos = [
                    ...camposPersonales,
                    ...camposLaborales,
                    ...camposHardware,
                    ...camposSoftware
                ];
                
                let cambiosDetectados = 0;
                
                todosCampos.forEach(campo => {
                    const input = document.getElementById(campo.id);
                    if (!input) return;
                    
                    const valorActual = input.value.trim();
                    const valorOriginal = campo.original;
                    
                    // Solo registrar si hay cambio real
                    if (valorActual && valorActual !== valorOriginal) {
                        registerChange(campo.nombre, valorOriginal, valorActual);
                        cambiosDetectados++;
                    }
                });
                
                // Mostrar mensaje de confirmación
                if (cambiosDetectados > 0) {
                    console.log(`✅ Se registraron ${cambiosDetectados} cambio(s) en el historial`);
                } else {
                    console.log('ℹ️ No se detectaron cambios');
                }
            }

            // Modificar el botón "Guardar Cambios" en la vista de edición
            window.addEventListener('DOMContentLoaded', function() {
                // Buscar el botón de guardar cambios en la vista de edición
                const saveButton = document.querySelector('#view-edit-profile .btn-primary-highlight');
                if (saveButton && saveButton.textContent.includes('Guardar Cambios')) {
                    saveButton.addEventListener('click', function(e) {
                        // Capturar cambios antes de guardar
                        captureFormChanges();
                    });
                }
            });

            // ============================================
            // INTEGRAR CON CAMBIOS DE DISPOSITIVOS
            // ============================================

            // Override de la función saveDeviceChanges existente
            const originalSaveDeviceChanges = saveDeviceChanges;
            window.saveDeviceChanges = function() {
                // Obtener valores antes del cambio
                const deviceName = document.getElementById('edit-device-name').value;
                const oldStatus = document.getElementById('edit-device-status').dataset.originalValue || 'En Almacén';
                const oldUser = document.getElementById('edit-device-user').dataset.originalValue || 'N/A';
                
                // Llamar a la función original
                if (originalSaveDeviceChanges) {
                    originalSaveDeviceChanges();
                }
                
                // Obtener nuevos valores
                const newStatus = document.getElementById('edit-device-status').value;
                const statusMap = {
                    'assigned': 'Asignado',
                    'storage': 'En Almacén',
                    'maintenance': 'En Mantenimiento',
                    'damaged': 'Dañado'
                };
                const newStatusText = statusMap[newStatus];
                const newUser = document.getElementById('edit-device-user').value.trim() || 'N/A';
                
                // Registrar cambios
                if (oldStatus !== newStatusText) {
                    registerChange(`${deviceName} - Estado`, oldStatus, newStatusText);
                }
                if (oldUser !== newUser) {
                    registerChange(`${deviceName} - Usuario`, oldUser, newUser);
                }
            };

            // Guardar valores originales cuando se abre el modal de edición
            const originalOpenEditDeviceModal = openEditDeviceModal;
            window.openEditDeviceModal = function(button) {
                if (originalOpenEditDeviceModal) {
                    originalOpenEditDeviceModal(button);
                }
                
                // Guardar valores originales
                setTimeout(() => {
                    const statusSelect = document.getElementById('edit-device-status');
                    const userInput = document.getElementById('edit-device-user');
                    
                    if (statusSelect) {
                        statusSelect.dataset.originalValue = statusSelect.options[statusSelect.selectedIndex].text;
                    }
                    if (userInput) {
                        userInput.dataset.originalValue = userInput.value;
                    }
                }, 100);
            };

            // ============================================
            // DEMO: Agregar cambio de prueba
            // ============================================

            // Función para agregar un cambio de prueba (puedes eliminar esto en producción)
            function addDemoChange() {
                registerChange(
                    'RAM',
                    '8 GB',
                    '32 GB',
                    'Admin TI'
                );
                alert('✅ Cambio de prueba agregado. Ve a la pestaña "Historial" para verlo.');
            }

            // Inicializar la tabla al cargar la página
            window.addEventListener('load', function() {
                updateHistoryTable();
            });

            // AGREGAR esta función nueva al final del script:
            function saveAllChanges() {
                // 1. Capturar todos los cambios
                captureFormChanges();
                
                // 2. Mostrar mensaje de éxito
                alert('✅ Cambios guardados exitosamente');
                
                // 3. Actualizar la vista de perfil con los nuevos datos
                updateProfileView();
                
                // 4. Volver a la vista de perfil
                showProfileViewFromEdit();
            }

            // AGREGAR también esta función para actualizar la vista:
            function updateProfileView() {
                // Actualizar todos los campos visibles en la vista de perfil
                // con los valores del formulario de edición
                
                // Ejemplo: Actualizar nombre
                const nombreEdit = document.getElementById('edit-nombre-completo');
                if (nombreEdit) {
                    // Actualizar en la vista de perfil
                    const nombreDisplay = document.querySelector('#view-profile .profile-name');
                    if (nombreDisplay) {
                        nombreDisplay.textContent = nombreEdit.value;
                    }
                }   
            }
            // ============================================
            // 🆕 CATÁLOGO DE HARDWARE - INICIO
            // ============================================
            
            // Variables globales del catálogo
            let selectedDevices = []; // Array para almacenar dispositivos seleccionados

            // ============================================
            // ABRIR CATÁLOGO DE HARDWARE
            // ============================================
            function openCatalogModal() {
                console.log('🔵 Abriendo catálogo de hardware...');
                
                const modal = document.getElementById('hardware-catalog-modal');
                if (!modal) {
                    console.error('❌ Modal de catálogo no encontrado');
                    alert('Error: No se encontró el catálogo de hardware');
                    return;
                }

                // Mostrar modal
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Resetear selección
                selectedDevices = [];
                updateConfirmButton();
                
                // Limpiar búsqueda y filtros
                const searchInput = document.getElementById('catalog-search-input');
                const categoryFilter = document.getElementById('catalog-category-filter');
                
                if (searchInput) searchInput.value = '';
                if (categoryFilter) categoryFilter.value = 'all';
                
                // Mostrar todos los dispositivos
                filterDevices();
                
                console.log('✅ Catálogo abierto');
            }

            // ============================================
            // CERRAR CATÁLOGO DE HARDWARE
            // ============================================
            function closeCatalogModal() {
                const modal = document.getElementById('hardware-catalog-modal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                
                // Limpiar selecciones visuales
                document.querySelectorAll('.catalog-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelectorAll('.catalog-btn-assign').forEach(btn => {
                    btn.textContent = 'Asignar';
                    btn.classList.remove('selected');
                });
                
                selectedDevices = [];
                console.log('🔵 Catálogo cerrado');
            }

            // ============================================
            // SELECCIONAR/DESELECCIONAR DISPOSITIVO
            // ============================================
            function selectDevice(deviceId, buttonElement) {
                console.log('📦 Dispositivo clickeado:', deviceId);
                
                const card = buttonElement.closest('.catalog-card');
                const index = selectedDevices.indexOf(deviceId);
                
                if (index > -1) {
                    // Ya está seleccionado - deseleccionar
                    selectedDevices.splice(index, 1);
                    card.classList.remove('selected');
                    buttonElement.textContent = 'Asignar';
                    buttonElement.classList.remove('selected');
                } else {
                    // Seleccionar
                    selectedDevices.push(deviceId);
                    card.classList.add('selected');
                    buttonElement.innerHTML = '<span class="material-symbols-outlined" style="font-size: 1.25rem;">check</span> Seleccionado';
                    buttonElement.classList.add('selected');
                }
                
                updateConfirmButton();
                console.log('✅ Dispositivos seleccionados:', selectedDevices);
            }

            // ============================================
            // ACTUALIZAR ESTADO DEL BOTÓN CONFIRMAR
            // ============================================
            function updateConfirmButton() {
                const confirmBtn = document.getElementById('confirm-assignment-btn');
                if (!confirmBtn) return;
                
                if (selectedDevices.length > 0) {
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                    confirmBtn.style.cursor = 'pointer';
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.style.cursor = 'not-allowed';
                }
            }

            // ============================================
            // CONFIRMAR ASIGNACIÓN
            // ============================================
            function confirmHardwareAssignment() {
                if (selectedDevices.length === 0) {
                    alert('⚠️ Por favor selecciona al menos un dispositivo');
                    return;
                }
                
                console.log('✅ Confirmando asignación de:', selectedDevices);
                
                // Agregar dispositivos a la tabla del formulario
                selectedDevices.forEach(deviceId => {
                    const card = document.querySelector(`[data-device-id="${deviceId}"]`);
                    if (card) {
                        const deviceName = card.querySelector('.catalog-card-title').textContent;
                        const category = card.querySelector('.catalog-card-category').textContent;
                        
                        // Agregar a la tabla de hardware asignado
                        addHardwareToTable(deviceName, category, deviceId);
                    }
                });
                
                alert(`✅ ${selectedDevices.length} dispositivo(s) asignado(s) exitosamente`);
                closeCatalogModal();
            }

            // ============================================
            // BÚSQUEDA Y FILTRADO
            // ============================================
            function filterDevices() {
                const searchInput = document.getElementById('catalog-search-input');
                const categoryFilter = document.getElementById('catalog-category-filter');
                
                const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                const category = categoryFilter ? categoryFilter.value : 'all';
                
                const cards = document.querySelectorAll('.catalog-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    const title = card.querySelector('.catalog-card-title')?.textContent.toLowerCase() || '';
                    const cardCategory = card.getAttribute('data-category') || '';
                    const deviceId = card.getAttribute('data-device-id')?.toLowerCase() || '';
                    
                    const matchesSearch = title.includes(searchTerm) || deviceId.includes(searchTerm);
                    const matchesCategory = category === 'all' || cardCategory === category;
                    
                    if (matchesSearch && matchesCategory) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Mostrar mensaje si no hay resultados
                const grid = document.getElementById('catalog-devices-grid');
                if (!grid) return;
                
                let noResultsMsg = grid.querySelector('.no-results-message');
                
                if (visibleCount === 0) {
                    if (!noResultsMsg) {
                        noResultsMsg = document.createElement('div');
                        noResultsMsg.className = 'no-results-message';
                        noResultsMsg.innerHTML = `
                            <span class="material-symbols-outlined" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">search_off</span>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 1.1rem;">No se encontraron dispositivos</p>
                            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">Intenta con otros términos de búsqueda</p>
                        `;
                        grid.appendChild(noResultsMsg);
                    }
                } else {
                    if (noResultsMsg) {
                        noResultsMsg.remove();
                    }
                }
            }

            // ============================================
            // INICIALIZACIÓN DE EVENT LISTENERS
            // ============================================
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🔵 Inicializando catálogo de hardware...');
                
                // Event listener para búsqueda
                const searchInput = document.getElementById('catalog-search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', filterDevices);
                    console.log('✅ Búsqueda inicializada');
                }
                
                // Event listener para filtro de categoría
                const categoryFilter = document.getElementById('catalog-category-filter');
                if (categoryFilter) {
                    categoryFilter.addEventListener('change', filterDevices);
                    console.log('✅ Filtro de categoría inicializado');
                }
            });

            // Event listener para cerrar con ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('hardware-catalog-modal');
                    if (modal && modal.style.display === 'flex') {
                        closeCatalogModal();
                    }
                }
            });

            // Event listener para cerrar al hacer clic en el overlay
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('hardware-catalog-modal');
                if (modal && e.target === modal) {
                    closeCatalogModal();
                }
            });

    </script>
</body>
</html>